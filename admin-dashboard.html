<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Ateli√™ da Lel√™</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'rose-pastel': '#FDF2F8',
                        'rose-light': '#FCE7F3',
                        'rose-medium': '#F9A8D4',
                        'rose-dark': '#EC4899',
                        'beige': '#F5F5DC',
                        'gold': '#FFD700',
                        'cream': '#FFF8DC'
                    },
                    fontFamily: {
                        'cursive': ['Dancing Script', 'cursive'],
                        'elegant': ['Playfair Display', 'serif']
                    }
                }
            }
        }
    </script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Custom CSS for Image Management -->
    <style>
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        /* Image Thumbnail Styles */
        .image-thumbnail {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .image-thumbnail:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .image-thumbnail img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display: block;
        }
        
        .image-thumbnail-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .image-thumbnail:hover .image-thumbnail-overlay {
            opacity: 1;
        }
        
        .image-actions {
            display: flex;
            gap: 8px;
        }
        
        .image-action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .image-action-btn.edit {
            background: #3b82f6;
            color: white;
        }
        
        .image-action-btn.edit:hover {
            background: #2563eb;
            transform: scale(1.1);
        }
        
        .image-action-btn.delete {
            background: #ef4444;
            color: white;
        }
        
        .image-action-btn.delete:hover {
            background: #dc2626;
            transform: scale(1.1);
        }
        
        .image-action-btn.download {
            background: #10b981;
            color: white;
        }
        
        .image-action-btn.download:hover {
            background: #059669;
            transform: scale(1.1);
        }
        
        /* Upload Area Styles */
        .upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            background: #f9fafb;
        }
        
        .upload-area.dragover {
            border-color: #ec4899;
            background: #fdf2f8;
        }
        
        .upload-area:hover {
            border-color: #ec4899;
            background: #fdf2f8;
        }
        
        /* Loading States */
        .image-loading {
            position: relative;
            background: #f3f4f6;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .image-loading::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* Responsive Grid */
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        @media (max-width: 768px) {
            .image-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 0.75rem;
            }
            
            .image-thumbnail img {
                height: 100px;
            }
        }
        
        /* Notification Styles */
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1001;
            animation: slideIn 0.3s ease;
        }
        
        .notification.success {
            background: #10b981;
        }
        
        .notification.error {
            background: #ef4444;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* File Input Styling */
        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #6b7280;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Check Authentication -->
    <script>
        if (localStorage.getItem('adminLoggedIn') !== 'true') {
            window.location.href = 'admin-login.html';
        }
    </script>

    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <h1 class="text-2xl font-cursive text-rose-medium font-bold">
                        Ateli√™ da Lel√™ - Admin
                    </h1>
                </div>
                
                <div class="flex items-center space-x-4">
                    <span class="text-gray-600">
                        <i class="fas fa-user mr-2"></i>
                        <span id="adminUser">Admin</span>
                    </span>
                    <button onclick="logout()" class="text-red-500 hover:text-red-700 transition-colors duration-300">
                        <i class="fas fa-sign-out-alt mr-1"></i>
                        Sair
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex">
        <!-- Sidebar -->
        <aside class="w-64 bg-white shadow-sm min-h-screen">
            <nav class="p-4">
                <ul class="space-y-2">
                    <li>
                        <a href="#dashboard" onclick="showSection('dashboard')" 
                           class="flex items-center px-4 py-3 text-gray-700 bg-rose-pastel rounded-lg hover:bg-rose-light transition-colors duration-300">
                            <i class="fas fa-tachometer-alt mr-3"></i>
                            Dashboard
                        </a>
                    </li>
                    <li>
                        <a href="#products" onclick="showSection('products')" 
                           class="flex items-center px-4 py-3 text-gray-700 hover:bg-rose-pastel rounded-lg transition-colors duration-300">
                            <i class="fas fa-box mr-3"></i>
                            Produtos
                        </a>
                    </li>
                    <li>
                        <a href="#images" onclick="showSection('images')" 
                           class="flex items-center px-4 py-3 text-gray-700 hover:bg-rose-pastel rounded-lg transition-colors duration-300">
                            <i class="fas fa-images mr-3"></i>
                            Imagens
                        </a>
                    </li>
                    <li>
                        <a href="#testimonials" onclick="showSection('testimonials')" 
                           class="flex items-center px-4 py-3 text-gray-700 hover:bg-rose-pastel rounded-lg transition-colors duration-300">
                            <i class="fas fa-comments mr-3"></i>
                            Depoimentos
                        </a>
                    </li>
                    <li>
                        <a href="#settings" onclick="showSection('settings')" 
                           class="flex items-center px-4 py-3 text-gray-700 hover:bg-rose-pastel rounded-lg transition-colors duration-300">
                            <i class="fas fa-cog mr-3"></i>
                            Configura√ß√µes
                        </a>
                    </li>
                    <li>
                        <a href="index.html" target="_blank" 
                           class="flex items-center px-4 py-3 text-gray-700 hover:bg-rose-pastel rounded-lg transition-colors duration-300">
                            <i class="fas fa-external-link-alt mr-3"></i>
                            Ver Site
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8">
            <!-- Dashboard Section -->
            <div id="dashboard" class="section">
                <div class="mb-8">
                    <h2 class="text-3xl font-elegant text-gray-800 mb-2">Dashboard</h2>
                    <p class="text-gray-600">Bem-vindo ao painel administrativo do Ateli√™ da Lel√™</p>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-rose-medium">
                        <div class="flex items-center">
                            <div class="p-3 bg-rose-pastel rounded-full">
                                <i class="fas fa-box text-rose-medium text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total de Produtos</p>
                                <p class="text-2xl font-semibold text-gray-900">8</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-blue-500">
                        <div class="flex items-center">
                            <div class="p-3 bg-blue-50 rounded-full">
                                <i class="fas fa-images text-blue-500 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Imagens</p>
                                <p class="text-2xl font-semibold text-gray-900">12</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-green-500">
                        <div class="flex items-center">
                            <div class="p-3 bg-green-50 rounded-full">
                                <i class="fas fa-comments text-green-500 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Depoimentos</p>
                                <p class="text-2xl font-semibold text-gray-900">3</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-purple-500">
                        <div class="flex items-center">
                            <div class="p-3 bg-purple-50 rounded-full">
                                <i class="fas fa-eye text-purple-500 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Visualiza√ß√µes</p>
                                <p class="text-2xl font-semibold text-gray-900">1,234</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">A√ß√µes R√°pidas</h3>
                        <div class="space-y-3">
                            <button onclick="showSection('products')" class="w-full text-left p-3 bg-rose-pastel rounded-lg hover:bg-rose-light transition-colors duration-300">
                                <i class="fas fa-plus mr-2"></i>
                                Adicionar Novo Produto
                            </button>
                            <button onclick="showSection('images')" class="w-full text-left p-3 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors duration-300">
                                <i class="fas fa-upload mr-2"></i>
                                Fazer Upload de Imagem
                            </button>
                            <button onclick="showSection('testimonials')" class="w-full text-left p-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors duration-300">
                                <i class="fas fa-plus mr-2"></i>
                                Adicionar Depoimento
                            </button>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Atividade Recente</h3>
                        <div class="space-y-3">
                            <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                                <div class="w-2 h-2 bg-green-500 rounded-full mr-3"></div>
                                <div>
                                    <p class="text-sm font-medium text-gray-800">Produto atualizado</p>
                                    <p class="text-xs text-gray-500">√Ålbum de Casamento - h√° 2 horas</p>
                                </div>
                            </div>
                            <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                                <div class="w-2 h-2 bg-blue-500 rounded-full mr-3"></div>
                                <div>
                                    <p class="text-sm font-medium text-gray-800">Nova imagem adicionada</p>
                                    <p class="text-xs text-gray-500">Scrapbook Baby - h√° 1 dia</p>
                                </div>
                            </div>
                            <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                                <div class="w-2 h-2 bg-purple-500 rounded-full mr-3"></div>
                                <div>
                                    <p class="text-sm font-medium text-gray-800">Depoimento publicado</p>
                                    <p class="text-xs text-gray-500">Maria Silva - h√° 3 dias</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Section -->
            <div id="products" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-elegant text-gray-800 mb-2">Gerenciar Produtos</h2>
                    <p class="text-gray-600">Adicione, edite ou remova produtos do site</p>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-800">Lista de Produtos</h3>
                        <button onclick="showAddProductForm()" class="bg-rose-medium text-white px-4 py-2 rounded-lg hover:bg-rose-dark transition-colors duration-300">
                            <i class="fas fa-plus mr-2"></i>
                            Novo Produto
                        </button>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3">Produto</th>
                                    <th class="px-6 py-3">Pre√ßo</th>
                                    <th class="px-6 py-3">Categoria</th>
                                    <th class="px-6 py-3">Status</th>
                                    <th class="px-6 py-3">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white border-b" data-product-id="default-1">
                                    <td class="px-6 py-4 font-medium text-gray-900">√Ålbum de Casamento</td>
                                    <td class="px-6 py-4">R$ 89,90</td>
                                    <td class="px-6 py-4">√Ålbuns</td>
                                    <td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Ativo</span></td>
                                    <td class="px-6 py-4">
                                        <button onclick="manageProductImages('default-1', '√Ålbum de Casamento')" class="text-green-600 hover:text-green-900 mr-3" title="Gerenciar Imagens">
                                            <i class="fas fa-images"></i>
                                        </button>
                                        <button onclick="editProduct('default-1')" class="text-blue-600 hover:text-blue-900 mr-3" title="Editar">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="deleteProduct('default-1')" class="text-red-600 hover:text-red-900" title="Remover">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="bg-white border-b" data-product-id="default-2">
                                    <td class="px-6 py-4 font-medium text-gray-900">Scrapbook Baby</td>
                                    <td class="px-6 py-4">R$ 75,00</td>
                                    <td class="px-6 py-4">√Ålbuns</td>
                                    <td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Ativo</span></td>
                                    <td class="px-6 py-4">
                                        <button onclick="manageProductImages('default-2', 'Scrapbook Baby')" class="text-green-600 hover:text-green-900 mr-3" title="Gerenciar Imagens">
                                            <i class="fas fa-images"></i>
                                        </button>
                                        <button onclick="editProduct('default-2')" class="text-blue-600 hover:text-blue-900 mr-3" title="Editar">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="deleteProduct('default-2')" class="text-red-600 hover:text-red-900" title="Remover">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="bg-white border-b" data-product-id="default-3">
                                    <td class="px-6 py-4 font-medium text-gray-900">Kit Scrapbook</td>
                                    <td class="px-6 py-4">R$ 45,00</td>
                                    <td class="px-6 py-4">Kits</td>
                                    <td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Ativo</span></td>
                                    <td class="px-6 py-4">
                                        <button onclick="manageProductImages('default-3', 'Kit Scrapbook')" class="text-green-600 hover:text-green-900 mr-3" title="Gerenciar Imagens">
                                            <i class="fas fa-images"></i>
                                        </button>
                                        <button onclick="editProduct('default-3')" class="text-blue-600 hover:text-blue-900 mr-3" title="Editar">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="deleteProduct('default-3')" class="text-red-600 hover:text-red-900" title="Remover">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Images Section -->
            <div id="images" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-elegant text-gray-800 mb-2">Como Gerenciar Imagens dos Produtos</h2>
                    <p class="text-gray-600">Guia r√°pido para adicionar imagens aos seus produtos</p>
                </div>

                <!-- ALERTA DE QUOTA -->
                <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-6">
                    <div class="flex items-start">
                        <i class="fas fa-exclamation-triangle text-red-500 text-xl mt-1 mr-3"></i>
                        <div>
                                                         <h3 class="text-lg font-semibold text-red-800 mb-3">üö® ERRO ATIVO: QuotaExceededError</h3>
                             <p class="text-red-700 mb-3"><strong>SOLU√á√ÉO IMEDIATA:</strong> Execute no console (F12) o comando: <code>corrigirQuotaAgora()</code></p>
                             <div class="flex gap-3">
                                 <button onclick="corrigirQuotaAgora()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors animate-pulse">
                                     <i class="fas fa-bolt mr-2"></i>
                                     üö® CORRE√á√ÉO IMEDIATA
                                 </button>
                                                                   <button onclick="navigator.clipboard.writeText('corrigirQuotaAgora()')" class="bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                      <i class="fas fa-copy mr-2"></i>
                                      Copiar Comando
                                  </button>
                                  <button onclick="resetCompleto()" class="bg-black text-white px-4 py-3 rounded-lg hover:bg-gray-800 transition-colors">
                                      <i class="fas fa-bomb mr-2"></i>
                                      üí• Reset Total
                                  </button>
                              </div>
                        </div>
                    </div>
                </div>

                <!-- Instru√ß√µes Claras -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
                    <div class="flex items-start">
                        <i class="fas fa-info-circle text-blue-500 text-xl mt-1 mr-3"></i>
                        <div>
                            <h3 class="text-lg font-semibold text-blue-800 mb-3">üì∏ Como Adicionar Imagens aos Produtos:</h3>
                            <ol class="list-decimal list-inside space-y-2 text-blue-700">
                                <li><strong>V√° para a se√ß√£o "Produtos"</strong> no menu lateral</li>
                                <li><strong>Clique no √≠cone verde üì∑</strong> do produto que deseja editar</li>
                                <li><strong>No modal que abrir</strong>, clique em "Selecionar Imagens"</li>
                                <li><strong>Escolha suas fotos</strong> (JPG, PNG, etc. - m√°ximo 5MB cada)</li>
                                <li><strong>As imagens aparecer√£o automaticamente</strong> na loja!</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- Teste R√°pido -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">üß™ Teste o Sistema</h3>
                    <p class="text-gray-600 mb-4">Use os bot√µes abaixo para testar se o sistema est√° funcionando:</p>
                    
                    <div class="flex flex-wrap gap-3">
                        <button onclick="demonstrarSistema()" class="bg-rose-500 text-white px-4 py-2 rounded-lg hover:bg-rose-600 transition-colors">
                            <i class="fas fa-play-circle mr-2"></i>
                            üé≠ Ver Demonstra√ß√£o
                        </button>
                        
                        <button onclick="corrigirQuotaAgora()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors animate-pulse">
                            <i class="fas fa-bolt mr-2"></i>
                            üö® Corre√ß√£o Imediata
                        </button>
                        
                        <button onclick="testAllImageIcons()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                            <i class="fas fa-play mr-2"></i>
                            Testar Todos os √çcones
                        </button>
                        
                        <button onclick="testImageIcon('default-1')" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            <i class="fas fa-camera mr-2"></i>
                            Testar √Ålbum de Casamento
                        </button>
                        
                        <button onclick="testImageSystem()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                            <i class="fas fa-cog mr-2"></i>
                            Testar Sistema Completo
                        </button>
                        
                        <button onclick="mostrarStatusStorage()" class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition-colors">
                            <i class="fas fa-chart-bar mr-2"></i>
                            üìä Ver Status Storage
                        </button>
                        
                        <button onclick="limparStorage()" class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors">
                            <i class="fas fa-broom mr-2"></i>
                            üßπ Limpar Storage
                        </button>
                        
                        <button onclick="limpezaDeEmergencia()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            üö® Limpeza de Emerg√™ncia
                        </button>
                    </div>
                </div>

                <!-- Status dos Produtos -->
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">üìä Status dos Produtos</h3>
                    <div id="productImageStatus" class="space-y-3">
                        <!-- Status ser√° preenchido dinamicamente -->
                    </div>
                    
                    <button onclick="updateProductImageStatus()" class="mt-4 bg-rose-medium text-white px-4 py-2 rounded-lg hover:bg-rose-dark transition-colors">
                        <i class="fas fa-sync mr-2"></i>
                        Atualizar Status
                    </button>
                </div>
            </div>

            <!-- Testimonials Section -->
            <div id="testimonials" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-elegant text-gray-800 mb-2">Gerenciar Depoimentos</h2>
                    <p class="text-gray-600">Gerencie os depoimentos dos clientes</p>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-800">Depoimentos dos Clientes</h3>
                        <button onclick="showAddTestimonialForm()" class="bg-rose-medium text-white px-4 py-2 rounded-lg hover:bg-rose-dark transition-colors duration-300">
                            <i class="fas fa-plus mr-2"></i>
                            Novo Depoimento
                        </button>
                    </div>

                    <div class="space-y-4">
                        <div class="border rounded-lg p-4">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h4 class="font-semibold text-gray-800">Maria Silva</h4>
                                    <div class="flex text-gold text-sm">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="text-blue-600 hover:text-blue-900"><i class="fas fa-edit"></i></button>
                                    <button class="text-red-600 hover:text-red-900"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                            <p class="text-gray-600 italic">"O √°lbum de casamento ficou perfeito! Cada detalhe foi feito com muito carinho. Recomendo demais o trabalho da Galega e Nicole!"</p>
                        </div>

                        <div class="border rounded-lg p-4">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h4 class="font-semibold text-gray-800">Ana Costa</h4>
                                    <div class="flex text-gold text-sm">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="text-blue-600 hover:text-blue-900"><i class="fas fa-edit"></i></button>
                                    <button class="text-red-600 hover:text-red-900"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                            <p class="text-gray-600 italic">"Comprei o kit scrapbook e adorei! Os materiais s√£o de √≥tima qualidade e as instru√ß√µes s√£o super claras. J√° estou fazendo meu segundo √°lbum!"</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-elegant text-gray-800 mb-2">Configura√ß√µes</h2>
                    <p class="text-gray-600">Configure as informa√ß√µes do site</p>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-6">
                    <form class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Site</label>
                            <input type="text" value="Ateli√™ da Lel√™" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                            <textarea rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">Transformando mem√≥rias em arte atrav√©s do scrapbook artesanal.</textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">WhatsApp</label>
                            <input type="text" value="(11) 99999-9999" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Instagram</label>
                            <input type="text" value="@ateliedalel√™" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Link da Shopee</label>
                            <input type="url" value="https://shopee.com.br/ateliedalel√™" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                        </div>

                        <button type="submit" class="bg-rose-medium text-white px-6 py-3 rounded-lg hover:bg-rose-dark transition-colors duration-300">
                            <i class="fas fa-save mr-2"></i>
                            Salvar Configura√ß√µes
                        </button>
                    </form>
                </div>

                <!-- Manuten√ß√£o Section -->
                <div class="bg-white rounded-lg shadow-sm p-6 mt-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Manuten√ß√£o do Sistema</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onclick="clearStorageData()" class="bg-red-500 text-white px-4 py-3 rounded-lg hover:bg-red-600 transition-colors duration-300">
                            <i class="fas fa-trash mr-2"></i>
                            Limpar Todos os Dados
                        </button>
                        <button onclick="restoreExcludedProducts()" class="bg-green-500 text-white px-4 py-3 rounded-lg hover:bg-green-600 transition-colors duration-300">
                            <i class="fas fa-undo mr-2"></i>
                            Restaurar Produtos Exclu√≠dos
                        </button>
                    </div>
                    <p class="text-sm text-gray-600 mt-3">
                        <strong>Aten√ß√£o:</strong> A limpeza de dados √© irrevers√≠vel. Use apenas se necess√°rio.
                    </p>
                </div>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script>
        // ========================================
        // CONSTANTES GLOBAIS
        // ========================================
        const FALLBACK_IMAGE = "img/fallback.jpg";
        const STORAGE_LIMIT = 4500000; // ~4.5MB
        const PRODUCT_CATEGORIES = {
            'albuns': '√Ålbuns',
            'kits': 'Kits', 
            'acessorios': 'Acess√≥rios',
            'personalizados': 'Personalizados',
            'outros': 'Outros'
        };

        // Set admin user name
        document.getElementById('adminUser').textContent = localStorage.getItem('adminUser') || 'Admin';

        // Navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update active nav item
            document.querySelectorAll('nav a').forEach(link => {
                link.classList.remove('bg-rose-pastel');
                link.classList.add('hover:bg-rose-pastel');
            });
            
            event.target.classList.add('bg-rose-pastel');
            event.target.classList.remove('hover:bg-rose-pastel');
        }

        // Logout function
        function logout() {
            localStorage.removeItem('adminLoggedIn');
            localStorage.removeItem('adminUser');
            window.location.href = 'admin-login.html';
        }

        // Image upload handling
        document.getElementById('imageUpload').addEventListener('change', function(e) {
            const files = e.target.files;
            if (files.length > 0) {
                handleImageUpload(files);
            }
        });

        // Drag and drop functionality
        const uploadArea = document.querySelector('.border-dashed');
        if (uploadArea) {
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('border-rose-medium', 'bg-rose-pastel');
            });

            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('border-rose-medium', 'bg-rose-pastel');
            });

            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('border-rose-medium', 'bg-rose-pastel');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleImageUpload(files);
                }
            });
        }

        function handleImageUpload(files) {
            const imageGallery = document.querySelector('#images .grid');
            const validFiles = Array.from(files).filter(file => file.type.startsWith('image/'));
            
            if (validFiles.length === 0) {
                showErrorMessage('Nenhuma imagem v√°lida selecionada!');
                return;
            }

            validFiles.forEach(file => {
                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    showErrorMessage(`Arquivo ${file.name} √© muito grande! M√°ximo 5MB.`);
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = {
                        src: e.target.result,
                        name: file.name,
                        id: Date.now() + Math.random()
                    };
                    addImageToGallery(imageData);
                    saveImageToStorage(imageData);
                };
                reader.readAsDataURL(file);
            });

            showSuccessMessage(`${validFiles.length} imagem(s) adicionada(s) com sucesso!`);
        }

        function addImageToGallery(imageData) {
            const imageGallery = document.querySelector('#images .grid');
            const imageDiv = document.createElement('div');
            imageDiv.className = 'relative group';
            imageDiv.setAttribute('data-image-id', imageData.id);
            imageDiv.innerHTML = `
                <img src="${imageData.src}" alt="${imageData.name}" class="w-full h-32 object-cover rounded-lg">
                <div class="absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-lg flex items-center justify-center">
                    <button class="text-white hover:text-red-400 transition-colors duration-300">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            imageGallery.appendChild(imageDiv);
        }

        function downloadImage(imageSrc, fileName) {
            const link = document.createElement('a');
            link.href = imageSrc;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function removeImage(imageId, button) {
            if (confirm('Tem certeza que deseja remover esta imagem?')) {
                removeImageFromStorage(imageId);
                button.closest('.relative').remove();
                showSuccessMessage('Imagem removida com sucesso!');
            }
        }

        // Form handlers
        function showAddProductForm() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-800">Adicionar Novo Produto</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form id="addProductForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Produto</label>
                            <input type="text" name="productName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                            <textarea name="description" rows="3" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pre√ßo (R$)</label>
                            <input type="number" name="price" step="0.01" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                            <select name="category" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                                <option value="">Selecione uma categoria</option>
                                <option value="albuns">√Ålbuns</option>
                                <option value="kits">Kits</option>
                                <option value="acessorios">Acess√≥rios</option>
                                <option value="personalizados">Personalizados</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Imagens do Produto</label>
                            <input type="file" name="productImages" accept="image/*" multiple class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                            <p class="text-xs text-gray-500 mt-1">Formatos aceitos: JPG, PNG. Tamanho m√°ximo: 5MB. Voc√™ pode selecionar m√∫ltiplas imagens.</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Link da Shopee</label>
                            <input type="url" name="shopeeLink" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-300">
                                Cancelar
                            </button>
                            <button type="submit" class="bg-rose-medium text-white px-6 py-2 rounded-lg hover:bg-rose-dark transition-colors duration-300">
                                <i class="fas fa-plus mr-2"></i>
                                Adicionar Produto
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle form submission
            document.getElementById('addProductForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(e.target);
                const productData = {
                    name: formData.get('productName'),
                    description: formData.get('description'),
                    price: formData.get('price'),
                    category: formData.get('category'),
                    shopeeLink: formData.get('shopeeLink'),
                    images: []
                };
                
                // Handle multiple images
                const imageFiles = formData.getAll('productImages');
                if (imageFiles.length > 0) {
                    imageFiles.forEach(file => {
                        if (file.size > 0) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                productData.images.push({
                                    src: e.target.result,
                                    name: file.name,
                                    id: Date.now() + Math.random()
                                });
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }
                
                // Add product to localStorage and list
                addProductToList(productData);
                saveProductToStorage(productData);
                closeModal();
                showSuccessMessage('Produto adicionado com sucesso!');
            });
        }

        function closeModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                // Clean up object URLs before closing
                cleanupObjectUrls();
                modal.remove();
            }
        }

        // ========================================
        // SE√á√ÉO: FUN√á√ïES DE PRODUTOS - REFATORADA
        // ========================================

        /**
         * Valida dados do produto antes de salvar
         */
        function validateProductData(productData) {
            const errors = [];
            
            // Valida√ß√£o de nome
            if (!productData.name || productData.name.trim().length < 2) {
                errors.push("Nome do produto deve ter pelo menos 2 caracteres");
            }
            
            // Valida√ß√£o de pre√ßo
            const price = parseFloat(productData.price);
            if (!productData.price || isNaN(price) || price <= 0) {
                errors.push("Pre√ßo deve ser um valor v√°lido maior que zero");
            }
            
            // Valida√ß√£o de descri√ß√£o
            if (!productData.description || productData.description.trim().length < 10) {
                errors.push("Descri√ß√£o deve ter pelo menos 10 caracteres");
            }
            
            // Valida√ß√£o de categoria
            if (!productData.category || !PRODUCT_CATEGORIES[productData.category]) {
                errors.push("Categoria deve ser selecionada");
            }
            
            return {
                isValid: errors.length === 0,
                errors: errors
            };
        }

        /**
         * Verifica se h√° espa√ßo suficiente no localStorage
         */
        function checkStorageSpace(additionalData = '') {
            try {
                const currentData = localStorage.getItem('atelieProducts') || '[]';
                const testData = currentData + additionalData;
                return testData.length < STORAGE_LIMIT;
            } catch (error) {
                console.error('Erro ao verificar espa√ßo no localStorage:', error);
                return false;
            }
        }

        /**
         * Formata pre√ßo para exibi√ß√£o
         */
        function formatPrice(price) {
            return parseFloat(price).toFixed(2).replace('.', ',');
        }

        /**
         * Gera ID √∫nico para produto
         */
        function generateProductId() {
            return `product_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        }

        // ========================================
        // GEST√ÉO DE PRODUTOS NO LOCALSTORAGE
        // ========================================
        
        /**
         * Adiciona um novo produto na lista e salva no localStorage
         */
        function addProductToList(productData) {
            try {
                // Valida dados do produto
                const validation = validateProductData(productData);
                if (!validation.isValid) {
                    showErrorMessage(`Erro de valida√ß√£o: ${validation.errors.join(', ')}`);
                    return false;
                }

                // Pega lista atual
                let products = JSON.parse(localStorage.getItem("atelieProducts")) || [];

                // Verifica se j√° existe produto com mesmo nome
                const existingProduct = products.find(p => p.name.toLowerCase() === productData.name.trim().toLowerCase());
                if (existingProduct) {
                    showErrorMessage("J√° existe um produto com este nome!");
                    return false;
                }

                // Processa imagens se fornecidas
                let processedImages = [];
                if (productData.images && productData.images.length > 0) {
                    processedImages = productData.images.map(img => ({
                        id: Date.now() + Math.random(),
                        src: img.src || FALLBACK_IMAGE,
                        name: img.name || 'Imagem do produto'
                    }));
                }

                // Garante ID √∫nico e formata dados
                const newProduct = {
                    id: generateProductId(),
                    name: productData.name.trim(),
                    description: productData.description.trim(),
                    price: parseFloat(productData.price).toFixed(2),
                    category: productData.category,
                    primarySrc: processedImages.length > 0 ? processedImages[0].src : FALLBACK_IMAGE,
                    images: processedImages,
                    shopeeLink: productData.shopeeLink || "",
                    status: "Ativo",
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                // Adiciona novo produto
                products.push(newProduct);

                // üö® CORRE√á√ÉO AGRESSIVA DE QUOTA
                try {
                    console.log('üîç Verificando espa√ßo antes de salvar...');
                    
                    // PRIMEIRA tentativa de verifica√ß√£o
                    const currentUsage = JSON.stringify(localStorage).length;
                    const newDataSize = JSON.stringify(products).length;
                    const maxStorage = 5 * 1024 * 1024; // 5MB
                    
                    console.log(`üìä Uso atual: ${(currentUsage/1024).toFixed(0)}KB, Novo: ${(newDataSize/1024).toFixed(0)}KB`);
                    
                    if (currentUsage + newDataSize > maxStorage * 0.85) {
                        console.log('‚ö†Ô∏è LIMITE DE 85% ATINGIDO! Executando limpeza...');
                        
                        // Limpeza SUPER agressiva
                        const originalProducts = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
                        const cleanProducts = originalProducts.map(p => ({
                            id: p.id,
                            name: p.name,
                            description: p.description,
                            price: p.price,
                            category: p.category,
                            shopeeLink: p.shopeeLink || '',
                            status: 'Ativo',
                            images: [], // Remove TODAS as imagens temporariamente
                            createdAt: p.createdAt || new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        }));
                        
                        // Limpa tudo e recria
                        localStorage.clear();
                        localStorage.setItem('atelieProducts', JSON.stringify([...cleanProducts, newProduct]));
                        localStorage.setItem('excludedProducts', '[]');
                        
                        console.log('‚úÖ Limpeza agressiva conclu√≠da!');
                        showWarningMessage('Produto salvo! Imagens foram removidas para liberar espa√ßo. Adicione imagens uma por vez.');
                        
                        // Atualiza UI e sai
                        renderProductList([...cleanProducts, newProduct]);
                        showSuccessMessage("Produto adicionado com sucesso!");
                        refreshStoreImages();
                        return true;
                    }

                    // Se passou na verifica√ß√£o, tenta salvar normalmente
                    localStorage.setItem("atelieProducts", JSON.stringify(products));
                    console.log('‚úÖ Produto salvo com sucesso (sem limpeza necess√°ria)');
                    
                } catch (error) {
                    console.error('‚ùå Erro ao salvar produto:', error);
                    if (error.name === 'QuotaExceededError') {
                        console.log('üö® QUOTA EXCEEDED! Aplicando corre√ß√£o imediata...');
                        
                        // CORRE√á√ÉO IMEDIATA E AGRESSIVA
                        try {
                            // Limpa TUDO primeiro
                            localStorage.clear();
                            
                            // Salva apenas os dados essenciais SEM imagens
                            const minimalProduct = {
                                id: newProduct.id,
                                name: newProduct.name,
                                description: newProduct.description,
                                price: newProduct.price,
                                category: newProduct.category,
                                shopeeLink: newProduct.shopeeLink || '',
                                status: 'Ativo',
                                images: [], // SEM IMAGENS
                                createdAt: newProduct.createdAt,
                                updatedAt: newProduct.updatedAt
                            };
                            
                            localStorage.setItem('atelieProducts', JSON.stringify([minimalProduct]));
                            localStorage.setItem('excludedProducts', '[]');
                            
                            console.log('‚úÖ CORRE√á√ÉO APLICADA! Produto salvo sem imagens.');
                            showWarningMessage('QUOTA CORRIGIDA! Produto salvo sem imagens. Sistema funcionando novamente!');
                            
                            // Recarrega a p√°gina para limpar cache
                            setTimeout(() => {
                                location.reload();
                            }, 2000);
                            
                            return true;
                            
                        } catch (emergencyError) {
                            console.error('‚ùå Erro na corre√ß√£o de emerg√™ncia:', emergencyError);
                            alert('üö® ERRO CR√çTICO!\n\nExecute no console:\ncorrigirQuotaAgora()\n\nOu feche o navegador e abra novamente.');
                            return false;
                        }
                    }
                    throw error;
                }

                // Atualiza UI
                renderProductList(products);
                showSuccessMessage("Produto adicionado com sucesso!");
                
                // Sincroniza com a loja
                refreshStoreImages();
                
                return true;
            } catch (e) {
                console.error("Erro ao adicionar produto:", e);
                showErrorMessage("Erro ao adicionar produto. Tente novamente.");
                return false;
            }
        }

        /**
         * Renderiza a lista de produtos na tabela do painel Admin.
         * Garante que n√£o h√° duplica√ß√µes ao redesenhar.
         */
        function renderProductList(products) {
            const tableBody = document.querySelector('#products table tbody');
            if (!tableBody) return;

            // Limpa a tabela antes de redesenhar (mant√©m apenas produtos padr√£o)
            const defaultProductIds = ['default-1', 'default-2', 'default-3'];
            const rows = tableBody.querySelectorAll('tr');
            rows.forEach(row => {
                const productId = row.getAttribute('data-product-id');
                if (!defaultProductIds.includes(productId)) {
                    row.remove();
                }
            });

            // Adiciona produtos do localStorage
            products.forEach(product => {
                const newRow = document.createElement('tr');
                newRow.className = 'bg-white border-b hover:bg-gray-50 transition-colors duration-200';
                newRow.setAttribute('data-product-id', product.id);
                newRow.innerHTML = `
                    <td class="px-6 py-4 font-medium text-gray-900">${escapeHtml(product.name)}</td>
                    <td class="px-6 py-4">R$ ${parseFloat(product.price).toFixed(2).replace('.', ',')}</td>
                    <td class="px-6 py-4">${getCategoryName(product.category) || 'Indefinida'}</td>
                    <td class="px-6 py-4">
                        <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">${product.status || 'Ativo'}</span>
                    </td>
                    <td class="px-6 py-4">
                        <button onclick="manageProductImages('${product.id}', '${escapeHtml(product.name)}')" 
                                class="text-green-600 hover:text-green-900 mr-3 transition-colors duration-200" 
                                title="Gerenciar Imagens">
                            <i class="fas fa-images"></i>
                        </button>
                        <button onclick="editProduct('${product.id}')" 
                                class="text-blue-600 hover:text-blue-900 mr-3 transition-colors duration-200" 
                                title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteProduct('${product.id}')" 
                                class="text-red-600 hover:text-red-900 transition-colors duration-200" 
                                title="Remover">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(newRow);
            });
        }

        /**
         * Carrega produtos do localStorage
         */
        function loadProductsFromStorage() {
            try {
                const products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
                renderProductList(products);
                console.log(`Carregados ${products.length} produtos do localStorage`);
            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
                showErrorMessage('Erro ao carregar produtos do armazenamento');
            }
        }

        /**
         * Remove produto do localStorage
         */
        function removeProductFromStorage(productId) {
            try {
                let products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
                products = products.filter(product => product.id !== productId);
                localStorage.setItem('atelieProducts', JSON.stringify(products));
                
                // Atualiza UI
                renderProductList(products);
                
                // Sincroniza com a loja
                refreshStoreImages();
                
                return true;
            } catch (error) {
                console.error('Erro ao remover produto:', error);
                showErrorMessage('Erro ao remover produto');
                return false;
            }
        }

        /**
         * Busca produto por ID considerando produtos padr√£o e salvos
         */
        function findProductById(productId) {
            // Primeiro, busca nos produtos salvos
            const savedProducts = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
            const savedProduct = savedProducts.find(p => p.id === productId);
            
            if (savedProduct) {
                return { product: savedProduct, source: 'saved', index: savedProducts.findIndex(p => p.id === productId) };
            }
            
            // Se n√£o encontrou nos salvos, busca nos produtos padr√£o (se for um ID padr√£o)
            if (productId.startsWith('default-')) {
                const defaultProducts = [
                    {
                        id: 'default-1',
                        name: '√Ålbum de Casamento',
                        description: '√Ålbum personalizado com detalhes em renda e flores secas. Perfeito para guardar as mem√≥rias mais especiais do seu grande dia.',
                        price: '89.90',
                        category: 'albuns',
                        shopeeLink: 'https://shopee.com.br/ateliedalel√™',
                        isDefault: true
                    },
                    {
                        id: 'default-2',
                        name: 'Scrapbook Baby',
                        description: '√Ålbum para registrar os primeiros momentos do beb√™. Cada p√°gina √© uma nova descoberta e sorriso.',
                        price: '75.00',
                        category: 'albuns',
                        shopeeLink: 'https://shopee.com.br/ateliedalel√™',
                        isDefault: true
                    },
                    {
                        id: 'default-3',
                        name: 'Kit Scrapbook Completo',
                        description: 'Kit completo com pap√©is decorativos, adesivos, fitas e acess√≥rios. Tudo que voc√™ precisa para criar mem√≥rias √∫nicas.',
                        price: '45.00',
                        category: 'kits',
                        shopeeLink: 'https://shopee.com.br/ateliedalel√™',
                        isDefault: true
                    },
                    {
                        id: 'default-4',
                        name: '√Ålbum de Viagem',
                        description: '√Ålbum especial para registrar suas aventuras e momentos inesquec√≠veis de viagem.',
                        price: '65.00',
                        category: 'albuns',
                        shopeeLink: 'https://shopee.com.br/ateliedalel√™',
                        isDefault: true
                    }
                ];
                
                const defaultProduct = defaultProducts.find(p => p.id === productId);
                if (defaultProduct) {
                    return { product: defaultProduct, source: 'default', index: -1 };
                }
            }
            
            return null;
        }

        /**
         * Atualiza produto no localStorage (AGORA SUPORTA PRODUTOS PADR√ÉO)
         */
        function updateProductInStorage(productId, updatedData) {
            try {
                console.log('Tentando atualizar produto:', productId, updatedData);
                
                const productData = findProductById(productId);
                
                if (!productData) {
                    console.error('Produto n√£o encontrado:', productId);
                    showErrorMessage('Produto n√£o encontrado. Verifique se o produto ainda existe.');
                    return false;
                }

                // Valida dados atualizados
                const validation = validateProductData(updatedData);
                if (!validation.isValid) {
                    showErrorMessage(`Erro de valida√ß√£o: ${validation.errors.join(', ')}`);
                    return false;
                }

                // Carrega produtos do localStorage
                let products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
                let productIndex = products.findIndex(p => p.id === productId);
                
                // Se √© produto padr√£o e n√£o existe no localStorage, cria entrada
                if (productIndex === -1 && productId.startsWith('default-')) {
                    console.log('Criando entrada no localStorage para produto padr√£o:', productId);
                    const defaultData = getDefaultProductData(productId);
                    if (defaultData) {
                        products.push(defaultData);
                        productIndex = products.length - 1;
                    }
                }
                
                // Se ainda n√£o encontrou, erro
                if (productIndex === -1) {
                    console.error('N√£o foi poss√≠vel criar/encontrar produto');
                    showErrorMessage('Erro ao localizar produto para atualiza√ß√£o.');
                    return false;
                }

                // Atualiza produto preservando imagens existentes
                const existingImages = products[productIndex].images || [];
                products[productIndex] = {
                    ...products[productIndex],
                    name: updatedData.name.trim(),
                    description: updatedData.description.trim(),
                    price: parseFloat(updatedData.price).toFixed(2),
                    category: updatedData.category,
                    shopeeLink: updatedData.shopeeLink || "",
                    images: existingImages, // Preserva imagens
                    updatedAt: new Date().toISOString(),
                    isDefault: productId.startsWith('default-') // Marca se √© produto padr√£o
                };

                localStorage.setItem('atelieProducts', JSON.stringify(products));
                console.log('Produto atualizado com sucesso');
                
                // Atualiza UI
                renderProductList(products);
                
                // Sincroniza com a loja
                refreshStoreImages();
                
                return true;
            } catch (error) {
                console.error('Erro ao atualizar produto:', error);
                showErrorMessage('Erro interno ao atualizar produto. Tente novamente.');
                return false;
            }
        }

        /**
         * Exibe formul√°rio para editar produto
         */
        function showEditProductForm(product) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-800">Editar Produto</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form id="editProductForm" class="space-y-4">
                        <input type="hidden" name="productId" value="${product.id}">
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Produto *</label>
                            <input type="text" name="productName" value="${escapeHtml(product.name)}" required minlength="2" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o *</label>
                            <textarea name="description" rows="3" required minlength="10" 
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">${escapeHtml(product.description)}</textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pre√ßo (R$) *</label>
                            <input type="number" name="price" step="0.01" min="0.01" value="${product.price}" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Categoria *</label>
                            <select name="category" required 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                                <option value="">Selecione uma categoria</option>
                                <option value="albuns" ${product.category === 'albuns' ? 'selected' : ''}>√Ålbuns</option>
                                <option value="kits" ${product.category === 'kits' ? 'selected' : ''}>Kits</option>
                                <option value="acessorios" ${product.category === 'acessorios' ? 'selected' : ''}>Acess√≥rios</option>
                                <option value="personalizados" ${product.category === 'personalizados' ? 'selected' : ''}>Personalizados</option>
                                <option value="outros" ${product.category === 'outros' ? 'selected' : ''}>Outros</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Link da Shopee</label>
                            <input type="url" name="shopeeLink" value="${escapeHtml(product.shopeeLink || '')}" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" 
                                    class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-300">
                                Cancelar
                            </button>
                            <button type="submit" 
                                    class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-300">
                                <i class="fas fa-save mr-2"></i>
                                Salvar Altera√ß√µes
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle form submission
            document.getElementById('editProductForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(e.target);
                const productId = formData.get('productId');
                const updatedData = {
                    name: formData.get('productName'),
                    description: formData.get('description'),
                    price: formData.get('price'),
                    category: formData.get('category'),
                    shopeeLink: formData.get('shopeeLink')
                };
                
                if (updateProductInStorage(productId, updatedData)) {
                    closeModal();
                    showSuccessMessage('Produto atualizado com sucesso!');
                }
            });
        }

        // ========================================
        // FUN√á√ïES AUXILIARES
        // ========================================
        
        /**
         * Escapa HTML para prevenir XSS
         */
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        /**
         * Obt√©m nome da categoria
         */
        function getCategoryName(category) {
            return PRODUCT_CATEGORIES[category] || category;
        }

        /**
         * Exibe formul√°rio para adicionar produto
         */
        function showAddProductForm() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-800">Adicionar Novo Produto</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form id="addProductForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Produto *</label>
                            <input type="text" name="productName" required minlength="2" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o *</label>
                            <textarea name="description" rows="3" required minlength="10" 
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pre√ßo (R$) *</label>
                            <input type="number" name="price" step="0.01" min="0.01" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Categoria *</label>
                            <select name="category" required 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                                <option value="">Selecione uma categoria</option>
                                <option value="albuns">√Ålbuns</option>
                                <option value="kits">Kits</option>
                                <option value="acessorios">Acess√≥rios</option>
                                <option value="personalizados">Personalizados</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Link da Shopee</label>
                            <input type="url" name="shopeeLink" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" 
                                    class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-300">
                                Cancelar
                            </button>
                            <button type="submit" 
                                    class="bg-rose-medium text-white px-6 py-2 rounded-lg hover:bg-rose-dark transition-colors duration-300">
                                <i class="fas fa-plus mr-2"></i>
                                Adicionar Produto
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle form submission
            document.getElementById('addProductForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(e.target);
                const productData = {
                    name: formData.get('productName'),
                    description: formData.get('description'),
                    price: formData.get('price'),
                    category: formData.get('category'),
                    shopeeLink: formData.get('shopeeLink')
                };
                
                if (addProductToList(productData)) {
                    closeModal();
                }
            });
        }

        /**
         * Exclui um produto pelo ID e atualiza a tabela e localStorage.
         */
        function deleteProduct(productId) {
            console.log('Tentando excluir produto:', productId);
            
            // Verifica se o produto existe antes de tentar excluir
            const productData = findProductById(productId);
            
            if (!productData) {
                console.error('Produto n√£o encontrado para exclus√£o:', productId);
                showErrorMessage('Produto n√£o encontrado. Pode ter sido exclu√≠do por outra sess√£o.');
                return;
            }
            
            // Produtos padr√£o - adiciona √† lista de exclus√£o
            if (productId.startsWith('default-')) {
                if (confirm(`Tem certeza que deseja remover "${productData.product.name}"?`)) {
                    // Add to excluded products list to prevent recreation
                    const excludedProducts = JSON.parse(localStorage.getItem('excludedProducts') || '[]');
                    if (!excludedProducts.includes(productId)) {
                        excludedProducts.push(productId);
                        localStorage.setItem('excludedProducts', JSON.stringify(excludedProducts));
                        console.log('Produto padr√£o adicionado √† lista de exclus√£o:', productId);
                    }
                    
                    // Remove from UI immediately
                    const row = document.querySelector(`tr[data-product-id="${productId}"]`);
                    if (row) {
                        row.remove();
                        console.log('Produto removido da UI');
                    }
                    
                    showSuccessMessage('Produto removido com sucesso!');
                    
                    // Simple sync without events (direct message only)
                    if (window.opener && window.opener.location.href.includes('loja.html')) {
                        window.opener.postMessage({
                            type: 'PRODUCT_DELETED',
                            productId: productId
                        }, '*');
                    }
                }
                return;
            }

            // Produtos salvos - remove do localStorage
            if (!confirm(`Tem certeza que deseja excluir "${productData.product.name}"?`)) {
                return;
            }

            try {
                let products = JSON.parse(localStorage.getItem("atelieProducts")) || [];
                const productIndex = products.findIndex(p => p.id === productId);

                if (productIndex === -1) {
                    console.error('Inconsist√™ncia: produto encontrado mas n√£o est√° no array para exclus√£o');
                    showErrorMessage("Erro de sincroniza√ß√£o. Produto pode ter sido exclu√≠do. Recarregue a p√°gina.");
                    return;
                }

                // Remove o produto do array
                products.splice(productIndex, 1);
                localStorage.setItem("atelieProducts", JSON.stringify(products));
                console.log('Produto exclu√≠do do localStorage');
                
                // Update UI immediately without triggering events
                const row = document.querySelector(`tr[data-product-id="${productId}"]`);
                if (row) {
                    row.remove();
                    console.log('Produto removido da UI');
                }
                
                showSuccessMessage("Produto exclu√≠do com sucesso!");
                
                // Simple sync without events (direct message only)
                if (window.opener && window.opener.location.href.includes('loja.html')) {
                    window.opener.postMessage({
                        type: 'PRODUCT_DELETED',
                        productId: productId
                    }, '*');
                }
                
            } catch (error) {
                console.error('Erro ao excluir produto:', error);
                showErrorMessage("Erro interno ao excluir produto. Tente novamente.");
            }
        }

        /**
         * Edita produto (AGORA PERMITE PRODUTOS PADR√ÉO)
         */
        function editProduct(productId) {
            console.log('Tentando editar produto:', productId);
            
            // Verifica se o produto existe
            const productData = findProductById(productId);
            
            if (!productData) {
                console.error('Produto n√£o encontrado para edi√ß√£o:', productId);
                showErrorMessage('Produto n√£o encontrado. Pode ter sido exclu√≠do por outra sess√£o.');
                return;
            }
            
            // AGORA PERMITE EDITAR PRODUTOS PADR√ÉO TAMB√âM!
            console.log('Abrindo formul√°rio de edi√ß√£o para:', productData.product.name);
            showEditProductForm(productData.product);
        }

        /**
         * Fecha modal
         */
        function closeModal() {
            const modal = document.querySelector('.fixed.inset-0');
            if (modal) {
                modal.remove();
            }
        }

        // ========================================
        // SE√á√ÉO: FUN√á√ïES DE NOTIFICA√á√ÉO
        // ========================================
        
        /**
         * Sistema de notifica√ß√µes
         */
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            if (type === 'info') icon = 'info-circle';
            
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${icon} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function showSuccessMessage(message) {
            showNotification(message, 'success');
        }

        function showErrorMessage(message) {
            showNotification(message, 'error');
        }

        function showWarningMessage(message) {
            showNotification(message, 'warning');
        }

        // ========================================
        // SE√á√ÉO: FUN√á√ïES DE DEPOIMENTOS
        // ========================================
        
        /**
         * Adiciona depoimento
         */
        function addTestimonial(testimonialData) {
            try {
                // Valida dados do depoimento
                const validation = validateTestimonialData(testimonialData);
                if (!validation.isValid) {
                    showErrorMessage(`Erro de valida√ß√£o: ${validation.errors.join(', ')}`);
                    return false;
                }

                let testimonials = JSON.parse(localStorage.getItem('atelieTestimonials') || '[]');
                
                const newTestimonial = {
                    id: `testimonial_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    name: testimonialData.name.trim(),
                    text: testimonialData.text.trim(),
                    rating: parseInt(testimonialData.rating),
                    date: new Date().toISOString(),
                    status: 'Ativo'
                };

                testimonials.push(newTestimonial);
                localStorage.setItem('atelieTestimonials', JSON.stringify(testimonials));
                
                renderTestimonialsList(testimonials);
                showSuccessMessage('Depoimento adicionado com sucesso!');
                
                return true;
            } catch (error) {
                console.error('Erro ao adicionar depoimento:', error);
                showErrorMessage('Erro ao adicionar depoimento');
                return false;
            }
        }

        /**
         * Valida dados do depoimento
         */
        function validateTestimonialData(testimonialData) {
            const errors = [];
            
            if (!testimonialData.name || testimonialData.name.trim().length < 2) {
                errors.push("Nome deve ter pelo menos 2 caracteres");
            }
            
            if (!testimonialData.text || testimonialData.text.trim().length < 10) {
                errors.push("Depoimento deve ter pelo menos 10 caracteres");
            }
            
            if (!testimonialData.rating || testimonialData.rating < 1 || testimonialData.rating > 5) {
                errors.push("Avalia√ß√£o deve ser entre 1 e 5 estrelas");
            }
            
            return {
                isValid: errors.length === 0,
                errors: errors
            };
        }

        /**
         * Renderiza lista de depoimentos
         */
        function renderTestimonialsList(testimonials) {
            const container = document.querySelector('#testimonials-list');
            if (!container) return;

            container.innerHTML = '';
            
            testimonials.forEach(testimonial => {
                const testimonialDiv = document.createElement('div');
                testimonialDiv.className = 'bg-white p-4 rounded-lg shadow-md mb-4';
                testimonialDiv.setAttribute('data-testimonial-id', testimonial.id);
                
                const stars = '‚òÖ'.repeat(testimonial.rating) + '‚òÜ'.repeat(5 - testimonial.rating);
                
                testimonialDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold text-gray-800">${escapeHtml(testimonial.name)}</h4>
                        <div class="flex space-x-2">
                            <button onclick="editTestimonial('${testimonial.id}')" 
                                    class="text-blue-600 hover:text-blue-800 transition-colors duration-200">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteTestimonial('${testimonial.id}')" 
                                    class="text-red-600 hover:text-red-800 transition-colors duration-200">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="text-yellow-500 mb-2">${stars}</div>
                    <p class="text-gray-600 text-sm">${escapeHtml(testimonial.text)}</p>
                    <div class="text-xs text-gray-400 mt-2">
                        ${new Date(testimonial.date).toLocaleDateString('pt-BR')}
                    </div>
                `;
                
                container.appendChild(testimonialDiv);
            });
        }

        /**
         * Carrega depoimentos do localStorage
         */
        function loadTestimonialsFromStorage() {
            try {
                const testimonials = JSON.parse(localStorage.getItem('atelieTestimonials') || '[]');
                renderTestimonialsList(testimonials);
                console.log(`Carregados ${testimonials.length} depoimentos do localStorage`);
            } catch (error) {
                console.error('Erro ao carregar depoimentos:', error);
                showErrorMessage('Erro ao carregar depoimentos do armazenamento');
            }
        }

        /**
         * Remove depoimento
         */
        function deleteTestimonial(testimonialId) {
            if (!confirm('Tem certeza que deseja remover este depoimento?')) return;

            try {
                let testimonials = JSON.parse(localStorage.getItem('atelieTestimonials') || '[]');
                testimonials = testimonials.filter(t => t.id !== testimonialId);
                localStorage.setItem('atelieTestimonials', JSON.stringify(testimonials));
                
                renderTestimonialsList(testimonials);
                showSuccessMessage('Depoimento removido com sucesso!');
            } catch (error) {
                console.error('Erro ao remover depoimento:', error);
                showErrorMessage('Erro ao remover depoimento');
            }
        }

        /**
         * Edita depoimento
         */
        function editTestimonial(testimonialId) {
            // TODO: Implementar formul√°rio de edi√ß√£o
            alert('Funcionalidade de edi√ß√£o de depoimentos ser√° implementada em breve!');
        }

        /**
         * Exibe formul√°rio para adicionar depoimento
         */
        function showAddTestimonialForm() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-800">Adicionar Depoimento</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form id="addTestimonialForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome *</label>
                            <input type="text" name="name" required minlength="2" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Depoimento *</label>
                            <textarea name="text" rows="4" required minlength="10" 
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Avalia√ß√£o *</label>
                            <select name="rating" required 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-medium focus:border-transparent">
                                <option value="">Selecione uma avalia√ß√£o</option>
                                <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5 estrelas)</option>
                                <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ (4 estrelas)</option>
                                <option value="3">‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ (3 estrelas)</option>
                                <option value="2">‚≠ê‚≠ê‚òÜ‚òÜ‚òÜ (2 estrelas)</option>
                                <option value="1">‚≠ê‚òÜ‚òÜ‚òÜ‚òÜ (1 estrela)</option>
                            </select>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" 
                                    class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-300">
                                Cancelar
                            </button>
                            <button type="submit" 
                                    class="bg-rose-medium text-white px-6 py-2 rounded-lg hover:bg-rose-dark transition-colors duration-300">
                                <i class="fas fa-plus mr-2"></i>
                                Adicionar Depoimento
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle form submission
            document.getElementById('addTestimonialForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(e.target);
                const testimonialData = {
                    name: formData.get('name'),
                    text: formData.get('text'),
                    rating: formData.get('rating')
                };
                
                if (addTestimonial(testimonialData)) {
                    closeModal();
                }
            });
        }

        // ========================================
        // SE√á√ÉO: FUN√á√ïES DE IMAGENS
        // ========================================
        
        // localStorage functions for images
        function saveImageToStorage(imageData) {
            let images = JSON.parse(localStorage.getItem('atelieImages') || '[]');
            images.push(imageData);
            localStorage.setItem('atelieImages', JSON.stringify(images));
        }

        function loadImagesFromStorage() {
            const images = JSON.parse(localStorage.getItem('atelieImages') || '[]');
            const imageGallery = document.querySelector('#images .grid');
            
            // Clear existing images (except the default placeholders)
            const defaultImages = document.querySelectorAll('#images .grid .relative');
            defaultImages.forEach(img => {
                if (img.querySelector('img[src*="placeholder"]')) {
                    img.remove();
                }
            });
            
            // Add images from localStorage
            images.forEach(imageData => {
                addImageToGallery(imageData);
            });
        }

        function removeImageFromStorage(imageId) {
            let images = JSON.parse(localStorage.getItem('atelieImages') || '[]');
            images = images.filter(image => image.id !== imageId);
            localStorage.setItem('atelieImages', JSON.stringify(images));
        }

        // ========================================
        // SE√á√ÉO REMOVIDA: FUN√á√ïES DUPLICADAS REMOVIDAS  
        // ========================================

        // Todas as fun√ß√µes duplicadas foram removidas!
            console.log('=== INICIANDO UPLOAD DE IMAGENS ===');
            console.log('Arquivos recebidos:', files.length);
            console.log('Produto ID:', productId);
            
            const validFiles = Array.from(files).filter(file => file.type.startsWith("image/"));
            if (validFiles.length === 0) {
                console.warn('Nenhuma imagem v√°lida encontrada');
                showNotification("Nenhuma imagem v√°lida selecionada!", "error");
                return;
            }

            console.log('Arquivos v√°lidos:', validFiles.length);

            // Verifica tamanho dos arquivos
            const maxSize = 5 * 1024 * 1024; // 5MB
            const oversizedFiles = validFiles.filter(file => file.size > maxSize);
            if (oversizedFiles.length > 0) {
                console.warn('Arquivos muito grandes:', oversizedFiles.map(f => f.name));
                showNotification(`Arquivos muito grandes: ${oversizedFiles.map(f => f.name).join(', ')}. M√°ximo 5MB.`, "error");
                return;
            }

            let uploadCount = 0;
            const totalFiles = validFiles.length;

            validFiles.forEach((file, index) => {
                console.log(`Processando arquivo ${index + 1}/${totalFiles}:`, file.name);
                
                const reader = new FileReader();
                reader.onload = function (e) {
                    try {
                        const newImageSrc = e.target.result;
                        const imageId = `img_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                        
                        const imageData = {
                            id: imageId,
                            src: newImageSrc,
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            uploadedAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        };
                        
                        console.log('Imagem processada:', imageData.id, imageData.name);

                        // Adiciona a imagem ao produto no localStorage
                        addImageToProduct(productId, imageData);
                        
                        // Adiciona a imagem na galeria visual
                        addImageToProductGallery(imageData, productId);
                        
                        uploadCount++;
                        
                        if (uploadCount === totalFiles) {
                            console.log('Todos os uploads conclu√≠dos');
                            showNotification(`${totalFiles} imagem(ns) adicionada(s) com sucesso!`, "success");
                            
                            // Atualiza a loja
                            refreshStoreImages();
                        }
                        
                    } catch (error) {
                        console.error('Erro ao processar imagem:', error);
                        showNotification(`Erro ao processar: ${file.name}`, "error");
                    }
                };
                
                reader.onerror = function() {
                    console.error('Erro ao ler arquivo:', file.name);
                    showNotification(`Erro ao ler arquivo: ${file.name}`, "error");
                };
                
                reader.readAsDataURL(file);
            });
        }

        /**
         * Adiciona imagem ao produto no localStorage
         */
        function addImageToProduct(productId, imageData) {
            try {
                console.log('Adicionando imagem ao produto:', productId, imageData.id);
                
                let products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
                let product = products.find(p => p.id === productId);
                
                // Se produto n√£o existe, cria um baseado nos dados padr√£o
                if (!product) {
                    const defaultData = getDefaultProductData(productId);
                    if (defaultData) {
                        product = defaultData;
                        products.push(product);
                    } else {
                        console.error('Produto n√£o encontrado e n√£o √© um produto padr√£o');
                        return;
                    }
                }
                
                // Garante que tem array de imagens
                if (!product.images) {
                    product.images = [];
                }
                
                // Adiciona a nova imagem
                product.images.push(imageData);
                
                // Define como imagem principal se for a primeira
                if (product.images.length === 1) {
                    product.primarySrc = imageData.src;
                }
                
                // Salva no localStorage
                localStorage.setItem('atelieProducts', JSON.stringify(products));
                
                console.log('Imagem adicionada ao localStorage. Total de imagens:', product.images.length);
                
            } catch (error) {
                console.error('Erro ao adicionar imagem ao produto:', error);
                showNotification('Erro ao salvar imagem', 'error');
            }
        }

        /**
         * Adiciona imagem na galeria do modal.
         */
        function addImageToProductGallery(imageData, productId) {
            const imageGallery = document.getElementById('productImageGallery');
            if (!imageGallery) {
                console.error('Galeria de imagens n√£o encontrada');
                return;
            }

            // Remove empty state if exists
            const emptyState = imageGallery.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }

            const imageDiv = document.createElement("div");
            imageDiv.className = "relative group bg-gray-100 rounded-lg overflow-hidden hover:shadow-lg transition-shadow";
            imageDiv.setAttribute("data-image-id", imageData.id);
            imageDiv.innerHTML = `
                <div class="aspect-square relative">
                    <img src="${imageData.src || FALLBACK_IMAGE}" 
                         alt="Imagem do Produto"
                         class="w-full h-full object-cover"
                         onerror="this.src='${FALLBACK_IMAGE}'; this.parentElement.nextElementSibling.style.display='block';">
                    
                    <!-- Loading overlay -->
                    <div class="absolute inset-0 bg-gray-200 flex items-center justify-center" style="display: none;">
                        <i class="fas fa-spinner fa-spin text-gray-500"></i>
                    </div>
                </div>
                
                <!-- Action buttons overlay -->
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 flex items-center justify-center opacity-0 group-hover:opacity-100">
                    <div class="flex space-x-2">
                        <button onclick="editProductImage('${imageData.id}', '${productId}')" 
                                class="bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition-colors"
                                title="Editar Imagem">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="removeProductImage('${imageData.id}', '${productId}', this)" 
                                class="bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-colors"
                                title="Remover Imagem">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button onclick="downloadProductImage('${imageData.src}', '${imageData.name || 'imagem'}')" 
                                class="bg-green-500 text-white p-2 rounded-full hover:bg-green-600 transition-colors"
                                title="Baixar Imagem">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Image info -->
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity">
                    <p class="text-white text-xs truncate">${imageData.name || 'Sem nome'}</p>
                </div>
            `;
            imageGallery.appendChild(imageDiv);
            
            console.log('Imagem adicionada √† galeria:', imageData.id);
        }

        /**
         * Edita imagem de produto
         */
        function editProductImage(imageId, productId) {
            console.log('Editando imagem:', imageId, 'do produto:', productId);
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.style.display = 'none';
            
            input.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    // Validar arquivo
                    if (!file.type.startsWith('image/')) {
                        showNotification('Por favor, selecione apenas arquivos de imagem.', 'error');
                        return;
                    }
                    
                    if (file.size > 5 * 1024 * 1024) { // 5MB
                        showNotification('Arquivo muito grande. M√°ximo 5MB.', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const newSrc = e.target.result;
                        
                        // Atualiza a imagem no localStorage
                        updateProductImageById(productId, imageId, newSrc, file.name);
                        
                        // Atualiza a imagem na UI
                        const imgElement = document.querySelector(`[data-image-id="${imageId}"] img`);
                        if (imgElement) {
                            imgElement.src = newSrc;
                            showNotification('Imagem atualizada com sucesso!', 'success');
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            document.body.appendChild(input);
            input.click();
            document.body.removeChild(input);
        }

        /**
         * Faz download de uma imagem
         */
        function downloadProductImage(imageSrc, imageName) {
            console.log('Fazendo download da imagem:', imageName);
            
            try {
                const link = document.createElement('a');
                link.href = imageSrc;
                link.download = imageName || 'imagem.jpg';
                link.style.display = 'none';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification('Download iniciado!', 'success');
            } catch (error) {
                console.error('Erro no download:', error);
                showNotification('Erro ao fazer download da imagem.', 'error');
            }
        }

        /**
         * Atualiza imagem espec√≠fica por ID
         */
        function updateProductImageById(productId, imageId, newSrc, newName) {
            try {
                let products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
                const product = products.find(p => p.id === productId);
                
                if (product && product.images) {
                    const imageIndex = product.images.findIndex(img => img.id === imageId);
                    if (imageIndex !== -1) {
                        product.images[imageIndex] = {
                            ...product.images[imageIndex],
                            src: newSrc,
                            name: newName,
                            updatedAt: new Date().toISOString()
                        };
                        
                        localStorage.setItem('atelieProducts', JSON.stringify(products));
                        console.log('Imagem atualizada no localStorage');
                        
                        // Atualiza loja se estiver aberta
                        refreshStoreImages();
                    }
                }
            } catch (error) {
                console.error('Erro ao atualizar imagem:', error);
            }
        }

        /**
         * Remove imagem do produto e atualiza localStorage.
         */
        function removeProductImage(imageId, productId, button) {
            if (!confirm("Tem certeza que deseja remover esta imagem?")) return;

            // Remove do DOM
            button.closest(".relative").remove();

            // Remove do produto no localStorage
            const products = JSON.parse(localStorage.getItem("atelieProducts")) || [];
            const product = products.find(p => p.id === productId);
            if (product && product.images) {
                product.images = product.images.filter(img => img.id !== imageId);
                // Se n√£o houver imagens, define fallback
                if (!product.images.length) {
                    product.primarySrc = FALLBACK_IMAGE;
                }
                localStorage.setItem("atelieProducts", JSON.stringify(products));
            }

            showNotification("Imagem removida com sucesso!", "success");
        }

        /**
         * Atualiza o campo primarySrc do produto.
         */
        function updateProductImage(productId, newImageSrc) {
            const products = JSON.parse(localStorage.getItem("atelieProducts")) || [];
            const product = products.find(p => p.id === productId);
            if (product) {
                product.primarySrc = newImageSrc;
                if (!product.images) product.images = [];
                product.images.push({ id: Date.now(), src: newImageSrc });
                localStorage.setItem("atelieProducts", JSON.stringify(products));
                
                // Update loja.html immediately
                updateLojaPage();
            }
        }

        /**
         * Atualiza as imagens da loja em tempo real (simplificado)
         */
        function refreshStoreImages() {
            try {
                // Get updated products from localStorage
                const products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
                
                // Update loja.html if it's open in another tab/window (direct message only)
                if (window.opener && window.opener.location.href.includes('loja.html')) {
                    window.opener.postMessage({
                        type: 'UPDATE_PRODUCTS',
                        products: products
                    }, '*');
                }
                
                console.log('Store images refresh triggered (simplified)');
            } catch (error) {
                console.error('Error refreshing store images:', error);
            }
        }

        /**
         * Update loja.html page when images change
         */
        function updateLojaPage() {
            // Show notification
            showNotification('Produto atualizado na loja!', 'success');
            
            // Get current products from localStorage
            const products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
            
            // Update loja.html in real-time if it's open
            if (window.opener && window.opener.location.href.includes('loja.html')) {
                // If loja.html is open in another tab/window
                window.opener.postMessage({
                    type: 'UPDATE_PRODUCTS',
                    products: products
                }, '*');
            }
            
            // Trigger custom event for real-time updates (only one event)
            window.dispatchEvent(new CustomEvent('productImagesUpdated', {
                detail: { products: products }
            }));
            
            // Update product cards directly if loja.html is in the same window
            updateProductCardsInLoja(products);
        }

        /**
         * Function to update product cards directly in loja.html
         */
        function updateProductCardsInLoja(products) {
            // Check if we're in the same window as loja.html
            if (window.location.href.includes('loja.html')) {
                // We're already in loja.html, update cards directly
                updateProductCards(products);
            } else {
                // Try to find loja.html in the same window
                const lojaFrame = document.querySelector('iframe[src*="loja.html"]');
                if (lojaFrame && lojaFrame.contentWindow) {
                    lojaFrame.contentWindow.postMessage({
                        type: 'UPDATE_PRODUCTS',
                        products: products
                    }, '*');
                }
            }
        }

        /**
         * Function to update product cards with new images
         */
        function updateProductCards(products) {
            products.forEach(product => {
                const productCard = document.querySelector(`[data-product-id="${product.id}"]`);
                if (productCard) {
                    const imageElement = productCard.querySelector('.product-image');
                    if (imageElement) {
                        // Get the best available image using primarySrc or images array
                        const bestImage = getBestImageForProduct(product);
                        if (bestImage) {
                            imageElement.src = bestImage;
                            imageElement.style.display = 'block';
                            
                            // Hide fallback content
                            const fallbackContent = productCard.querySelector('.fallback-content');
                            if (fallbackContent) {
                                fallbackContent.style.display = 'none';
                            }
                            
                            // Hide loading indicator
                            const loadingIndicator = productCard.querySelector('.loading-indicator');
                            if (loadingIndicator) {
                                loadingIndicator.style.display = 'none';
                            }
                        } else {
                            // No valid image, show fallback
                            showFallbackForProduct(productCard);
                        }
                    }
                }
            });
        }

        /**
         * Function to show fallback for a product card
         */
        function showFallbackForProduct(productCard) {
            const imageElement = productCard.querySelector('.product-image');
            const fallbackContent = productCard.querySelector('.fallback-content');
            const loadingIndicator = productCard.querySelector('.loading-indicator');
            
            if (imageElement) {
                imageElement.style.display = 'none';
            }
            
            if (fallbackContent) {
                fallbackContent.style.display = 'flex';
            }
            
            if (loadingIndicator) {
                loadingIndicator.style.display = 'none';
            }
        }

        /**
         * Function to get the best available image for a product
         */
        function getBestImageForProduct(product) {
            // First, check if product has a primarySrc
            if (product.primarySrc) {
                return product.primarySrc;
            }
            
            // If no primarySrc, check images array
            if (product.images && product.images.length > 0) {
                // First, try to find a real image (not uploads/ URL)
                const realImage = product.images.find(img => !img.src.startsWith('uploads/'));
                if (realImage) {
                    return realImage.src;
                }
                
                // If no real image, use the first uploaded image
                return product.images[0].src;
            }
            
            // If no images, return null (will use fallback)
            return null;
        }

        /**
         * Setup drag and drop functionality
         */
        function setupDragAndDrop(productId) {
            const uploadArea = document.getElementById('uploadArea');
            
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleProductImageUpload(files, productId);
                }
            });
        }

        /**
         * Handle image loading errors
         */
        function handleImageError(imgElement, imageId) {
            imgElement.style.display = 'none';
            const thumbnail = imgElement.closest('.image-thumbnail');
            if (thumbnail) {
                thumbnail.innerHTML = `
                    <div class="w-full h-full bg-gray-200 flex items-center justify-center rounded-lg">
                        <div class="text-center text-gray-500">
                            <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                            <p class="text-sm">Erro ao carregar</p>
                        </div>
                    </div>
                `;
            }
        }

        function showAddTestimonialForm() {
            alert('Formul√°rio de adicionar depoimento seria exibido aqui!');
        }

        // ========================================
        // SE√á√ÉO: CONFIGURA√á√ïES GERAIS
        // ========================================
        
        /**
         * Inicializa o dashboard
         */
        function initializeDashboard() {
            console.log('Inicializando dashboard...');
            
            // Carrega dados do localStorage
            loadProductsFromStorage();
            loadImagesFromStorage();
            loadTestimonialsFromStorage();
            
            // Adiciona listeners de eventos
            setupEventListeners();
            
            // Executa testes de valida√ß√£o
            runValidationTests();
            
            console.log('Dashboard inicializado com sucesso!');
        }

        /**
         * Configura listeners de eventos (simplificado para evitar loops)
         */
        function setupEventListeners() {
            // Storage event listener para sincroniza√ß√£o entre abas (apenas depoimentos)
            window.addEventListener('storage', function(e) {
                if (e.key === 'atelieTestimonials') {
                    console.log('Depoimentos atualizados em outra aba');
                    loadTestimonialsFromStorage();
                }
            });

            // Removidos event listeners que causavam loops de recarregamento
            console.log('Event listeners configurados (modo simplificado)');
        }

        /**
         * Limpa dados do localStorage (fun√ß√£o de manuten√ß√£o)
         */
        function clearStorageData() {
            if (confirm('Tem certeza que deseja limpar todos os dados? Esta a√ß√£o n√£o pode ser desfeita.')) {
                try {
                    localStorage.removeItem('atelieProducts');
                    localStorage.removeItem('atelieTestimonials');
                    localStorage.removeItem('atelieImages');
                    localStorage.removeItem('excludedProducts'); // Also clear excluded products
                    
                    // Recarrega as listas
                    loadProductsFromStorage();
                    loadTestimonialsFromStorage();
                    loadImagesFromStorage();
                    
                    showSuccessMessage('Dados limpos com sucesso!');
                } catch (error) {
                    console.error('Erro ao limpar dados:', error);
                    showErrorMessage('Erro ao limpar dados');
                }
            }
        }

        /**
         * Restaura produtos exclu√≠dos (fun√ß√£o de manuten√ß√£o)
         */
        function restoreExcludedProducts() {
            if (confirm('Tem certeza que deseja restaurar todos os produtos exclu√≠dos?')) {
                try {
                    localStorage.removeItem('excludedProducts');
                    
                    // Recarrega as listas
                    loadProductsFromStorage();
                    
                    showSuccessMessage('Produtos exclu√≠dos restaurados com sucesso!');
                } catch (error) {
                    console.error('Erro ao restaurar produtos:', error);
                    showErrorMessage('Erro ao restaurar produtos');
                }
            }
        }

        /**
         * Exporta dados do localStorage
         */
        function exportData() {
            try {
                const data = {
                    products: JSON.parse(localStorage.getItem('atelieProducts') || '[]'),
                    testimonials: JSON.parse(localStorage.getItem('atelieTestimonials') || '[]'),
                    images: JSON.parse(localStorage.getItem('atelieImages') || '[]'),
                    exportDate: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `atelie-data-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                showSuccessMessage('Dados exportados com sucesso!');
            } catch (error) {
                console.error('Erro ao exportar dados:', error);
                showErrorMessage('Erro ao exportar dados');
            }
        }

        // ========================================
        // SE√á√ÉO: VALIDA√á√ÉO E TESTES
        // ========================================
        
        /**
         * Executa testes de valida√ß√£o
         */
        function runValidationTests() {
            console.log('Executando testes de valida√ß√£o...');
            
            const tests = [
                testProductsSection,
                testImagesSection,
                testTestimonialsSection,
                testStorageLimits,
                testUIElements
            ];
            
            let passedTests = 0;
            let totalTests = tests.length;
            
            tests.forEach(test => {
                try {
                    if (test()) {
                        passedTests++;
                        console.log(`‚úÖ ${test.name} - PASSOU`);
                    } else {
                        console.log(`‚ùå ${test.name} - FALHOU`);
                    }
                } catch (error) {
                    console.log(`‚ùå ${test.name} - ERRO: ${error.message}`);
                }
            });
            
            console.log(`\nüìä RESULTADO DOS TESTES: ${passedTests}/${totalTests} testes passaram`);
            
            if (passedTests === totalTests) {
                console.log('üéâ Todos os testes passaram! Sistema funcionando corretamente.');
            } else {
                console.log('‚ö†Ô∏è Alguns testes falharam. Verifique os logs acima.');
            }
        }

        /**
         * Testa se√ß√£o de produtos
         */
        function testProductsSection() {
            // Testa se as fun√ß√µes existem
            if (typeof addProductToList !== 'function') return false;
            if (typeof renderProductList !== 'function') return false;
            if (typeof validateProductData !== 'function') return false;
            
            // Testa valida√ß√£o de dados
            const testProduct = {
                name: 'Teste',
                description: 'Descri√ß√£o de teste com mais de 10 caracteres',
                price: '10.00',
                category: 'albuns'
            };
            
            const validation = validateProductData(testProduct);
            if (!validation.isValid) return false;
            
            // Testa se a tabela existe
            const table = document.querySelector('#products table tbody');
            if (!table) return false;
            
            return true;
        }

        /**
         * Testa se√ß√£o de imagens
         */
        function testImagesSection() {
            // Testa se as fun√ß√µes existem
            if (typeof handleProductImageUpload !== 'function') return false;
            if (typeof addImageToProductGallery !== 'function') return false;
            if (typeof removeProductImage !== 'function') return false;
            
            // Testa se o fallback est√° definido
            if (typeof FALLBACK_IMAGE === 'undefined') return false;
            
            return true;
        }

        /**
         * Testa se√ß√£o de depoimentos
         */
        function testTestimonialsSection() {
            // Testa se as fun√ß√µes existem
            if (typeof addTestimonial !== 'function') return false;
            if (typeof renderTestimonialsList !== 'function') return false;
            if (typeof validateTestimonialData !== 'function') return false;
            
            // Testa valida√ß√£o de dados
            const testTestimonial = {
                name: 'Teste',
                text: 'Depoimento de teste com mais de 10 caracteres',
                rating: '5'
            };
            
            const validation = validateTestimonialData(testTestimonial);
            if (!validation.isValid) return false;
            
            return true;
        }

        /**
         * Testa limites de storage
         */
        function testStorageLimits() {
            // Testa se a fun√ß√£o de verifica√ß√£o existe
            if (typeof checkStorageSpace !== 'function') return false;
            
            // Testa se o limite est√° definido
            if (typeof STORAGE_LIMIT === 'undefined') return false;
            
            // Testa se o localStorage est√° dispon√≠vel
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
            } catch (error) {
                return false;
            }
            
            return true;
        }

        /**
         * Testa elementos da UI
         */
        function testUIElements() {
            // Testa se as fun√ß√µes de notifica√ß√£o existem
            if (typeof showNotification !== 'function') return false;
            if (typeof showSuccessMessage !== 'function') return false;
            if (typeof showErrorMessage !== 'function') return false;
            
            // Testa se as fun√ß√µes de modal existem
            if (typeof closeModal !== 'function') return false;
            if (typeof showAddProductForm !== 'function') return false;
            if (typeof showAddTestimonialForm !== 'function') return false;
            
            return true;
        }

        /**
         * Fun√ß√£o de diagn√≥stico do sistema
         */
        function diagnoseSystem() {
            console.log('üîç DIAGN√ìSTICO DO SISTEMA');
            console.log('========================');
            
            // Verifica localStorage
            console.log('\nüì¶ LOCALSTORAGE:');
            const products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
            const testimonials = JSON.parse(localStorage.getItem('atelieTestimonials') || '[]');
            const images = JSON.parse(localStorage.getItem('atelieImages') || '[]');
            
            console.log(`- Produtos: ${products.length}`);
            console.log(`- Depoimentos: ${testimonials.length}`);
            console.log(`- Imagens: ${images.length}`);
            
            // Verifica tamanho dos dados
            const totalSize = JSON.stringify(products).length + 
                            JSON.stringify(testimonials).length + 
                            JSON.stringify(images).length;
            console.log(`- Tamanho total: ${(totalSize / 1024).toFixed(2)} KB`);
            console.log(`- Limite: ${(STORAGE_LIMIT / 1024 / 1024).toFixed(2)} MB`);
            
            // Verifica elementos da UI
            console.log('\nüé® ELEMENTOS DA UI:');
            const productTable = document.querySelector('#products table tbody');
            const testimonialsList = document.querySelector('#testimonials-list');
            const imagesGrid = document.querySelector('#images .grid');
            
            console.log(`- Tabela de produtos: ${productTable ? '‚úÖ' : '‚ùå'}`);
            console.log(`- Lista de depoimentos: ${testimonialsList ? '‚úÖ' : '‚ùå'}`);
            console.log(`- Grid de imagens: ${imagesGrid ? '‚úÖ' : '‚ùå'}`);
            
            // Verifica fun√ß√µes
            console.log('\n‚öôÔ∏è FUN√á√ïES:');
            const functions = [
                'addProductToList', 'renderProductList', 'validateProductData',
                'handleProductImageUpload', 'addImageToProductGallery', 'removeProductImage',
                'addTestimonial', 'renderTestimonialsList', 'validateTestimonialData',
                'showNotification', 'showSuccessMessage', 'showErrorMessage',
                'closeModal', 'checkStorageSpace'
            ];
            
            functions.forEach(funcName => {
                const exists = typeof window[funcName] === 'function';
                console.log(`- ${funcName}: ${exists ? '‚úÖ' : '‚ùå'}`);
            });
            
            console.log('\nüéØ DIAGN√ìSTICO CONCLU√çDO');
        }

        // ========================================
        // INICIALIZA√á√ÉO
        // ========================================
        
        // Inicializa o dashboard quando a p√°gina carrega
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
        });

        // ========================================
        // SE√á√ÉO: TESTES AUTOM√ÅTICOS PARA PRODUTOS
        // ========================================
        
        /**
         * Teste completo da aba de produtos
         */
        function runProductTests() {
            console.log('üß™ INICIANDO TESTES DA ABA PRODUTOS');
            console.log('====================================');
            
            const tests = [
                testAddProduct,
                testEditProduct,
                testDeleteProduct,
                testProductValidation,
                testProductSynchronization
            ];
            
            let passedTests = 0;
            let totalTests = tests.length;
            
            tests.forEach((test, index) => {
                try {
                    console.log(`\nüìã Teste ${index + 1}: ${test.name}`);
                    if (test()) {
                        passedTests++;
                        console.log(`‚úÖ ${test.name} - PASSOU`);
                    } else {
                        console.log(`‚ùå ${test.name} - FALHOU`);
                    }
                } catch (error) {
                    console.log(`‚ùå ${test.name} - ERRO: ${error.message}`);
                }
            });
            
            console.log(`\nüìä RESULTADO DOS TESTES DE PRODUTOS: ${passedTests}/${totalTests} testes passaram`);
            
            if (passedTests === totalTests) {
                console.log('üéâ Todos os testes de produtos passaram!');
                return true;
            } else {
                console.log('‚ö†Ô∏è Alguns testes de produtos falharam.');
                return false;
            }
        }

        /**
         * Testa adi√ß√£o de produto
         */
        function testAddProduct() {
            const testProduct = {
                name: 'Produto Teste',
                description: 'Descri√ß√£o do produto teste com mais de 10 caracteres para valida√ß√£o',
                price: '25.50',
                category: 'albuns',
                shopeeLink: 'https://shopee.com.br/teste'
            };
            
            // Testa valida√ß√£o
            const validation = validateProductData(testProduct);
            if (!validation.isValid) {
                console.log('‚ùå Valida√ß√£o falhou:', validation.errors);
                return false;
            }
            
            // Testa adi√ß√£o
            const result = addProductToList(testProduct);
            if (!result) {
                console.log('‚ùå Adi√ß√£o de produto falhou');
                return false;
            }
            
            // Verifica se foi salvo no localStorage
            const products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
            const addedProduct = products.find(p => p.name === testProduct.name);
            if (!addedProduct) {
                console.log('‚ùå Produto n√£o foi salvo no localStorage');
                return false;
            }
            
            // Verifica se tem ID √∫nico
            if (!addedProduct.id || !addedProduct.id.startsWith('product_')) {
                console.log('‚ùå ID √∫nico n√£o foi gerado corretamente');
                return false;
            }
            
            // Verifica formata√ß√£o do pre√ßo
            if (addedProduct.price !== '25.50') {
                console.log('‚ùå Pre√ßo n√£o foi formatado corretamente');
                return false;
            }
            
            console.log('‚úÖ Produto adicionado com sucesso:', addedProduct);
            return true;
        }

        /**
         * Testa edi√ß√£o de produto
         */
        function testEditProduct() {
            // Busca um produto para editar
            const products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
            const productToEdit = products.find(p => p.name === 'Produto Teste');
            
            if (!productToEdit) {
                console.log('‚ùå Produto para editar n√£o encontrado');
                return false;
            }
            
            const updatedData = {
                name: 'Produto Teste Editado',
                description: 'Descri√ß√£o editada com mais de 10 caracteres',
                price: '35.75',
                category: 'kits',
                shopeeLink: 'https://shopee.com.br/teste-editado'
            };
            
            // Testa atualiza√ß√£o
            const result = updateProductInStorage(productToEdit.id, updatedData);
            if (!result) {
                console.log('‚ùå Atualiza√ß√£o de produto falhou');
                return false;
            }
            
            // Verifica se foi atualizado no localStorage
            const updatedProducts = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
            const updatedProduct = updatedProducts.find(p => p.id === productToEdit.id);
            
            if (!updatedProduct || updatedProduct.name !== updatedData.name) {
                console.log('‚ùå Produto n√£o foi atualizado corretamente');
                return false;
            }
            
            console.log('‚úÖ Produto editado com sucesso:', updatedProduct);
            return true;
        }

        /**
         * Testa exclus√£o de produto
         */
        function testDeleteProduct() {
            // Busca um produto para excluir
            const products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
            const productToDelete = products.find(p => p.name === 'Produto Teste Editado');
            
            if (!productToDelete) {
                console.log('‚ùå Produto para excluir n√£o encontrado');
                return false;
            }
            
            const initialCount = products.length;
            
            // Testa remo√ß√£o
            const result = removeProductFromStorage(productToDelete.id);
            if (!result) {
                console.log('‚ùå Remo√ß√£o de produto falhou');
                return false;
            }
            
            // Verifica se foi removido do localStorage
            const remainingProducts = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
            const deletedProduct = remainingProducts.find(p => p.id === productToDelete.id);
            
            if (deletedProduct) {
                console.log('‚ùå Produto n√£o foi removido do localStorage');
                return false;
            }
            
            if (remainingProducts.length !== initialCount - 1) {
                console.log('‚ùå Contagem de produtos incorreta ap√≥s remo√ß√£o');
                return false;
            }
            
            console.log('‚úÖ Produto removido com sucesso');
            return true;
        }

        /**
         * Testa valida√ß√µes de produto
         */
        function testProductValidation() {
            const testCases = [
                {
                    name: 'Teste Valida√ß√£o Nome Vazio',
                    data: { name: '', description: 'Descri√ß√£o v√°lida', price: '10.00', category: 'albuns' },
                    shouldPass: false
                },
                {
                    name: 'Teste Valida√ß√£o Nome Curto',
                    data: { name: 'A', description: 'Descri√ß√£o v√°lida', price: '10.00', category: 'albuns' },
                    shouldPass: false
                },
                {
                    name: 'Teste Valida√ß√£o Pre√ßo Inv√°lido',
                    data: { name: 'Produto V√°lido', description: 'Descri√ß√£o v√°lida', price: '-5.00', category: 'albuns' },
                    shouldPass: false
                },
                {
                    name: 'Teste Valida√ß√£o Descri√ß√£o Curta',
                    data: { name: 'Produto V√°lido', description: 'Curta', price: '10.00', category: 'albuns' },
                    shouldPass: false
                },
                {
                    name: 'Teste Valida√ß√£o Categoria Inv√°lida',
                    data: { name: 'Produto V√°lido', description: 'Descri√ß√£o v√°lida', price: '10.00', category: 'categoria_invalida' },
                    shouldPass: false
                },
                {
                    name: 'Teste Valida√ß√£o Dados V√°lidos',
                    data: { name: 'Produto V√°lido', description: 'Descri√ß√£o v√°lida com mais de 10 caracteres', price: '10.00', category: 'albuns' },
                    shouldPass: true
                }
            ];
            
            let passedTests = 0;
            
            testCases.forEach(testCase => {
                const validation = validateProductData(testCase.data);
                const passed = validation.isValid === testCase.shouldPass;
                
                if (passed) {
                    passedTests++;
                    console.log(`‚úÖ ${testCase.name} - PASSOU`);
                } else {
                    console.log(`‚ùå ${testCase.name} - FALHOU (esperado: ${testCase.shouldPass}, obtido: ${validation.isValid})`);
                }
            });
            
            return passedTests === testCases.length;
        }

        /**
         * Testa sincroniza√ß√£o com a loja
         */
        function testProductSynchronization() {
            // Testa se a fun√ß√£o refreshStoreImages existe
            if (typeof refreshStoreImages !== 'function') {
                console.log('‚ùå Fun√ß√£o refreshStoreImages n√£o encontrada');
                return false;
            }
            
            // Testa se a fun√ß√£o updateLojaPage existe
            if (typeof updateLojaPage !== 'function') {
                console.log('‚ùå Fun√ß√£o updateLojaPage n√£o encontrada');
                return false;
            }
            
            // Simula uma atualiza√ß√£o
            try {
                refreshStoreImages();
                console.log('‚úÖ Sincroniza√ß√£o com loja funcionando');
                return true;
            } catch (error) {
                console.log('‚ùå Erro na sincroniza√ß√£o:', error.message);
                return false;
            }
        }

        // Fun√ß√£o global para diagn√≥stico (pode ser chamada no console)
        window.diagnoseSystem = diagnoseSystem;
        window.runValidationTests = runValidationTests;
        window.runProductTests = runProductTests;
        window.clearStorageData = clearStorageData;
        window.restoreExcludedProducts = restoreExcludedProducts;
        window.exportData = exportData;

        /**
         * Verifica e corrige integridade dos dados do localStorage
         */
        function checkAndFixDataIntegrity() {
            try {
                // Verifica produtos salvos
                const savedProducts = localStorage.getItem('atelieProducts');
                if (savedProducts) {
                    try {
                        const products = JSON.parse(savedProducts);
                        if (!Array.isArray(products)) {
                            console.warn('Dados de produtos corrompidos, limpando...');
                            localStorage.setItem('atelieProducts', '[]');
                        }
                    } catch (e) {
                        console.warn('Erro ao parsear produtos, limpando dados corrompidos...');
                        localStorage.setItem('atelieProducts', '[]');
                    }
                }
                
                // Verifica produtos exclu√≠dos
                const excludedProducts = localStorage.getItem('excludedProducts');
                if (excludedProducts) {
                    try {
                        const excluded = JSON.parse(excludedProducts);
                        if (!Array.isArray(excluded)) {
                            console.warn('Dados de produtos exclu√≠dos corrompidos, limpando...');
                            localStorage.setItem('excludedProducts', '[]');
                        }
                    } catch (e) {
                        console.warn('Erro ao parsear produtos exclu√≠dos, limpando dados corrompidos...');
                        localStorage.setItem('excludedProducts', '[]');
                    }
                }
                
                console.log('Verifica√ß√£o de integridade conclu√≠da');
            } catch (error) {
                console.error('Erro durante verifica√ß√£o de integridade:', error);
            }
        }

        // Executa verifica√ß√£o de integridade ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            checkAndFixDataIntegrity();
        });

        // ========================================
        // SE√á√ÉO: FUN√á√ïES DE GERENCIAMENTO DE IMAGENS (ORDEM CORRIGIDA)
        // ========================================



        /**
         * Gerencia imagens de um produto espec√≠fico
         */
        function closeImageModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                console.log('Fechando modal de imagens');
                modal.remove();
            }
        }

        /**
         * Fun√ß√£o de teste para verificar se o sistema de imagens est√° funcionando
         */
        function testImageSystem() {
            console.log('=== TESTANDO SISTEMA DE IMAGENS ===');
            
            const tests = [];
            
            // Teste 1: Fun√ß√£o manageProductImages existe
            tests.push({
                name: 'Fun√ß√£o manageProductImages',
                passed: typeof manageProductImages === 'function',
                details: typeof manageProductImages === 'function' ? 'OK' : 'Fun√ß√£o n√£o encontrada'
            });
            
            // Teste 2: Fun√ß√£o initializeProductImages existe
            tests.push({
                name: 'Fun√ß√£o initializeProductImages',
                passed: typeof initializeProductImages === 'function',
                details: typeof initializeProductImages === 'function' ? 'OK' : 'Fun√ß√£o n√£o encontrada'
            });
            
            // Teste 3: Fun√ß√£o loadProductImages existe
            tests.push({
                name: 'Fun√ß√£o loadProductImages',
                passed: typeof loadProductImages === 'function',
                details: typeof loadProductImages === 'function' ? 'OK' : 'Fun√ß√£o n√£o encontrada'
            });
            
            // Teste 4: localStorage est√° dispon√≠vel
            tests.push({
                name: 'localStorage dispon√≠vel',
                passed: typeof localStorage !== 'undefined',
                details: typeof localStorage !== 'undefined' ? 'OK' : 'localStorage n√£o dispon√≠vel'
            });
            
            // Teste 5: FALLBACK_IMAGE est√° definido
            tests.push({
                name: 'FALLBACK_IMAGE definido',
                passed: typeof FALLBACK_IMAGE !== 'undefined',
                details: typeof FALLBACK_IMAGE !== 'undefined' ? `OK: ${FALLBACK_IMAGE}` : 'Constante n√£o definida'
            });
            
            // Teste 6: Font Awesome carregado
            const faTest = document.querySelector('i.fas') || document.querySelector('link[href*="font-awesome"]');
            tests.push({
                name: 'Font Awesome carregado',
                passed: !!faTest,
                details: faTest ? 'OK' : 'Font Awesome pode n√£o estar carregado'
            });
            
            // Exibe resultados
            console.log('Resultados dos testes:');
            tests.forEach(test => {
                const status = test.passed ? '‚úÖ' : '‚ùå';
                console.log(`${status} ${test.name}: ${test.details}`);
            });
            
            const passedTests = tests.filter(t => t.passed).length;
            const totalTests = tests.length;
            
            if (passedTests === totalTests) {
                console.log('üéâ Todos os testes passaram! O sistema deve estar funcionando.');
                showNotification('Sistema de imagens funcionando corretamente!', 'success');
            } else {
                console.log(`‚ö†Ô∏è ${totalTests - passedTests} teste(s) falharam. Verifique os erros acima.`);
                showNotification(`${passedTests}/${totalTests} testes passaram. Verifique o console.`, 'warning');
            }
            
            return { passedTests, totalTests, tests };
        }

        // Executa teste automaticamente ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Inicializando sistema administrativo...');
            
            // Executa verifica√ß√£o de integridade
            checkAndFixDataIntegrity();
            
            // Verifica storage logo no in√≠cio
            const storageStatus = monitorarStorage();
            if (storageStatus.status === 'warning') {
                console.warn('‚ö†Ô∏è Storage quase cheio detectado!');
                setTimeout(() => {
                    showNotification('‚ö†Ô∏è Mem√≥ria quase cheia! Considere limpeza na se√ß√£o Imagens.', 'warning');
                }, 2000);
            }
            
            // Aguarda um pouco e executa testes
            setTimeout(() => {
                console.log('üß™ Executando testes autom√°ticos...');
                testImageSystem();
                
                // Atualiza status das imagens
                setTimeout(() => {
                    updateProductImageStatus();
                }, 500);
                
                // Mostra notifica√ß√£o de boas-vindas
                setTimeout(() => {
                    if (storageStatus.status !== 'warning') {
                        showNotification('Sistema carregado! Use a se√ß√£o "Imagens" para ver como funciona.', 'success');
                    }
                }, 1000);
                
            }, 1000);
        });

        /**
         * Testa se o √≠cone de imagem est√° funcionando para um produto espec√≠fico
         */
        function testImageIcon(productId) {
            console.log('üß™ Testando √≠cone de imagem para produto:', productId);
            
            // Encontra o bot√£o do √≠cone
            const imageButton = document.querySelector(`button[onclick*="manageProductImages('${productId}'"]`);
            
            if (!imageButton) {
                console.error('‚ùå Bot√£o de imagem n√£o encontrado para produto:', productId);
                showNotification('Bot√£o de imagem n√£o encontrado!', 'error');
                return false;
            }
            
            console.log('‚úÖ Bot√£o encontrado, tentando abrir modal...');
            
            // Simula clique
            try {
                manageProductImages(productId, `Teste ${productId}`);
                console.log('‚úÖ Modal deve ter aberto!');
                showNotification('Teste conclu√≠do - verifique se o modal abriu!', 'success');
                return true;
            } catch (error) {
                console.error('‚ùå Erro ao abrir modal:', error);
                showNotification('Erro ao abrir modal de imagens!', 'error');
                return false;
            }
        }

        /**
         * Testa todos os √≠cones de imagem da p√°gina
         */
        function testAllImageIcons() {
            console.log('üß™ Testando todos os √≠cones de imagem...');
            
            const products = ['default-1', 'default-2', 'default-3', 'default-4'];
            const results = [];
            
            products.forEach(productId => {
                const result = testImageIcon(productId);
                results.push({ productId, success: result });
            });
            
            const successCount = results.filter(r => r.success).length;
            console.log(`üìä Resultado: ${successCount}/${results.length} √≠cones funcionando`);
            
            if (successCount === results.length) {
                showNotification('Todos os √≠cones est√£o funcionando!', 'success');
            } else {
                showNotification(`${successCount}/${results.length} √≠cones funcionando`, 'warning');
            }
            
            return results;
        }

        // Exp√µe fun√ß√µes de teste globalmente
        window.testImageIcon = testImageIcon;
        window.testAllImageIcons = testAllImageIcons;

        /**
         * Atualiza o status das imagens dos produtos
         */
        function updateProductImageStatus() {
            console.log('Atualizando status das imagens dos produtos...');
            
            const statusContainer = document.getElementById('productImageStatus');
            if (!statusContainer) return;
            
            const products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
            const defaultProducts = [
                { id: 'default-1', name: '√Ålbum de Casamento' },
                { id: 'default-2', name: 'Scrapbook Baby' },
                { id: 'default-3', name: 'Kit Scrapbook Completo' },
                { id: 'default-4', name: '√Ålbum de Viagem' }
            ];
            
            let statusHTML = '';
            
            defaultProducts.forEach(defaultProd => {
                const savedProduct = products.find(p => p.id === defaultProd.id);
                const imageCount = savedProduct?.images?.length || 0;
                const hasImages = imageCount > 0;
                
                const statusIcon = hasImages ? '‚úÖ' : '‚ö†Ô∏è';
                const statusText = hasImages ? `${imageCount} imagem(ns)` : 'Sem imagens';
                const statusColor = hasImages ? 'text-green-600' : 'text-amber-600';
                
                statusHTML += `
                    <div class="flex items-center justify-between p-3 border rounded-lg">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">${statusIcon}</span>
                            <div>
                                <h4 class="font-medium text-gray-800">${defaultProd.name}</h4>
                                <p class="text-sm ${statusColor}">${statusText}</p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="testImageIcon('${defaultProd.id}')" 
                                    class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition-colors"
                                    title="Testar √≠cone">
                                üß™ Testar
                            </button>
                            <button onclick="manageProductImages('${defaultProd.id}', '${defaultProd.name}')" 
                                    class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors"
                                    title="Adicionar imagens">
                                üì∑ Imagens
                            </button>
                        </div>
                    </div>
                `;
            });
            
            // Adiciona produtos personalizados
            const customProducts = products.filter(p => !p.id.startsWith('default-'));
            if (customProducts.length > 0) {
                statusHTML += `
                    <div class="border-t pt-4 mt-4">
                        <h4 class="font-medium text-gray-800 mb-3">üì¶ Produtos Personalizados:</h4>
                `;
                
                customProducts.forEach(product => {
                    const imageCount = product.images?.length || 0;
                    const hasImages = imageCount > 0;
                    
                    const statusIcon = hasImages ? '‚úÖ' : '‚ö†Ô∏è';
                    const statusText = hasImages ? `${imageCount} imagem(ns)` : 'Sem imagens';
                    const statusColor = hasImages ? 'text-green-600' : 'text-amber-600';
                    
                    statusHTML += `
                        <div class="flex items-center justify-between p-3 border rounded-lg mb-2">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">${statusIcon}</span>
                                <div>
                                    <h4 class="font-medium text-gray-800">${product.name}</h4>
                                    <p class="text-sm ${statusColor}">${statusText}</p>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="manageProductImages('${product.id}', '${product.name}')" 
                                        class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors">
                                    üì∑ Imagens
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                statusHTML += '</div>';
            }
            
            statusContainer.innerHTML = statusHTML;
            
            // Contadores
            const totalProducts = defaultProducts.length + customProducts.length;
            const productsWithImages = [...defaultProducts, ...customProducts].filter(p => {
                const saved = products.find(sp => sp.id === p.id);
                return saved?.images?.length > 0;
            }).length;
            
            console.log(`Status atualizado: ${productsWithImages}/${totalProducts} produtos com imagens`);
            showNotification(`${productsWithImages}/${totalProducts} produtos t√™m imagens`, 'info');
        }

        // Exp√µe fun√ß√£o globalmente
        window.updateProductImageStatus = updateProductImageStatus;

        // Exp√µe todas as fun√ß√µes de teste globalmente
        window.testImageSystem = testImageSystem;
        window.testImageIcon = testImageIcon;
        window.testAllImageIcons = testAllImageIcons;

        /**
         * Demonstra√ß√£o completa do sistema de imagens
         */
        function demonstrarSistema() {
            console.log('üé≠ Iniciando demonstra√ß√£o do sistema...');
            
            let step = 1;
            const totalSteps = 4;
            
            function nextStep(message, action) {
                showNotification(`Passo ${step}/${totalSteps}: ${message}`, 'info');
                setTimeout(action, 2000);
                step++;
            }
            
            // Passo 1: Mostrar se√ß√£o produtos
            nextStep('Vamos para a se√ß√£o Produtos', () => {
                showSection('products');
                
                // Passo 2: Destacar √≠cone de imagem
                nextStep('Veja os √≠cones verdes üì∑ na tabela', () => {
                    const firstImageIcon = document.querySelector('[title="Gerenciar Imagens"]');
                    if (firstImageIcon) {
                        firstImageIcon.style.animation = 'pulse 1s infinite';
                        firstImageIcon.style.backgroundColor = '#10B981';
                        firstImageIcon.style.borderRadius = '50%';
                        firstImageIcon.style.padding = '8px';
                    }
                    
                    // Passo 3: Abrir modal de exemplo
                    nextStep('Abrindo modal de imagens...', () => {
                        manageProductImages('default-1', '√Ålbum de Casamento');
                        
                        // Passo 4: Explicar o modal
                        nextStep('Aqui voc√™ adiciona imagens! Clique em "Selecionar Imagens"', () => {
                            console.log('‚úÖ Demonstra√ß√£o conclu√≠da!');
                            showNotification('üéâ Agora voc√™ j√° sabe como usar! Clique nos √≠cones üì∑ para gerenciar imagens.', 'success');
                        });
                    });
                });
            });
        }

        // Exp√µe fun√ß√£o de demonstra√ß√£o
        window.demonstrarSistema = demonstrarSistema;

        /**
         * Fun√ß√£o de debug para verificar se as fun√ß√µes est√£o carregadas
         */
        function debugImageSystem() {
            console.log('üîç Debug do Sistema de Imagens:');
            
            const requiredFunctions = [
                'initializeProductImages',
                'getDefaultProductData', 
                'loadProductImages',
                'manageProductImages',
                'handleProductImageUpload',
                'addImageToProductGallery'
            ];
            
            const results = {};
            
            requiredFunctions.forEach(funcName => {
                try {
                    const func = window[funcName] || eval(funcName);
                    results[funcName] = typeof func === 'function' ? '‚úÖ OK' : '‚ùå N√£o √© fun√ß√£o';
                } catch (error) {
                    results[funcName] = '‚ùå N√£o definida';
                }
            });
            
            console.table(results);
            
            // Teste b√°sico do modal
            console.log('üß™ Testando abertura do modal...');
            try {
                manageProductImages('default-1', 'Teste Debug');
                console.log('‚úÖ Modal aberto com sucesso!');
                return true;
            } catch (error) {
                console.error('‚ùå Erro ao abrir modal:', error);
                return false;
            }
        }

        // Exp√µe fun√ß√£o de debug globalmente
        window.debugImageSystem = debugImageSystem;

        /**
         * FUN√á√ÉO DE EMERG√äNCIA - Abre modal de imagens mesmo com erros
         */
        function forceImageModal(productId = 'default-1', productName = 'Teste') {
            console.log('üö® FOR√áANDO ABERTURA DO MODAL...');
            
            try {
                // Remove modal existente
                const existingModal = document.querySelector('.modal-overlay');
                if (existingModal) existingModal.remove();
                
                // Cria modal b√°sico
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0; left: 0; right: 0; bottom: 0;
                    background: rgba(0,0,0,0.8);
                    z-index: 9999;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                `;
                
                modal.innerHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; max-width: 600px; width: 90%;">
                        <h2 style="margin: 0 0 1rem 0; font-size: 1.5rem;">Gerenciar Imagens - ${productName}</h2>
                        
                        <div style="border: 2px dashed #ccc; padding: 2rem; text-align: center; margin: 1rem 0;">
                            <p style="margin: 0 0 1rem 0;">üì∏ Clique para selecionar imagens</p>
                            <input type="file" id="emergencyUpload" multiple accept="image/*" style="display: none;">
                            <button onclick="document.getElementById('emergencyUpload').click()" 
                                    style="background: #ec4899; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer;">
                                Selecionar Imagens
                            </button>
                        </div>
                        
                        <div id="emergencyGallery" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 1rem; margin: 1rem 0;">
                            <!-- Imagens aparecer√£o aqui -->
                        </div>
                        
                        <div style="text-align: center; margin-top: 1rem;">
                            <button onclick="this.closest('.modal-overlay').remove()" 
                                    style="background: #666; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer;">
                                Fechar
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Adiciona funcionalidade de upload
                const uploadInput = document.getElementById('emergencyUpload');
                const gallery = document.getElementById('emergencyGallery');
                
                uploadInput.addEventListener('change', function(e) {
                    Array.from(e.target.files).forEach(file => {
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                const img = document.createElement('img');
                                img.src = e.target.result;
                                img.style.cssText = 'width: 100%; height: 100px; object-fit: cover; border-radius: 4px;';
                                gallery.appendChild(img);
                                
                                console.log('‚úÖ Imagem carregada:', file.name);
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                });
                
                console.log('‚úÖ Modal de emerg√™ncia criado!');
                return true;
                
            } catch (error) {
                console.error('‚ùå Erro no modal de emerg√™ncia:', error);
                alert('Erro cr√≠tico! Recarregue a p√°gina.');
                return false;
            }
        }

        // Exp√µe fun√ß√£o de emerg√™ncia globalmente
        window.forceImageModal = forceImageModal;

        /**
         * Inicializa imagens de produto se n√£o existirem
         */
        function initializeProductImages(productId) {
            try {
                console.log('Inicializando imagens para produto:', productId);
                
                let products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
                let product = products.find(p => p.id === productId);
                
                // Se n√£o existe nos produtos salvos, verifica se √© produto padr√£o
                if (!product && productId.startsWith('default-')) {
                    // Cria entrada para produto padr√£o se n√£o existir
                    const defaultProductData = getDefaultProductData(productId);
                    if (defaultProductData) {
                        products.push(defaultProductData);
                        localStorage.setItem('atelieProducts', JSON.stringify(products));
                        product = defaultProductData;
                    }
                }
                
                // Garante que o produto tem array de imagens
                if (product && !product.images) {
                    product.images = [];
                    localStorage.setItem('atelieProducts', JSON.stringify(products));
                }
                
                console.log('Produto inicializado:', product);
            } catch (error) {
                console.error('Erro ao inicializar imagens do produto:', error);
            }
        }

        /**
         * Obt√©m dados padr√£o para produtos padr√£o
         */
        function getDefaultProductData(productId) {
            const defaultProducts = {
                'default-1': {
                    id: 'default-1',
                    name: '√Ålbum de Casamento',
                    description: '√Ålbum personalizado com detalhes em renda e flores secas.',
                    price: '89.90',
                    category: 'albuns',
                    images: [],
                    isDefault: true,
                    createdAt: new Date().toISOString()
                },
                'default-2': {
                    id: 'default-2',
                    name: 'Scrapbook Baby',
                    description: '√Ålbum para registrar os primeiros momentos do beb√™.',
                    price: '75.00',
                    category: 'albuns',
                    images: [],
                    isDefault: true,
                    createdAt: new Date().toISOString()
                },
                'default-3': {
                    id: 'default-3',
                    name: 'Kit Scrapbook Completo',
                    description: 'Kit completo com pap√©is decorativos, adesivos e acess√≥rios.',
                    price: '45.00',
                    category: 'kits',
                    images: [],
                    isDefault: true,
                    createdAt: new Date().toISOString()
                },
                'default-4': {
                    id: 'default-4',
                    name: '√Ålbum de Viagem',
                    description: '√Ålbum especial para registrar suas aventuras de viagem.',
                    price: '65.00',
                    category: 'albuns',
                    images: [],
                    isDefault: true,
                    createdAt: new Date().toISOString()
                }
            };
            
            return defaultProducts[productId] || null;
        }

        /**
         * Carrega e exibe imagens existentes do produto
         */
        function loadProductImages(productId) {
            try {
                console.log('Carregando imagens para produto:', productId);
                
                const imageGallery = document.getElementById('productImageGallery');
                if (!imageGallery) {
                    console.error('Elemento productImageGallery n√£o encontrado');
                    return;
                }
                
                // Limpa galeria
                imageGallery.innerHTML = '';
                
                // Busca produto
                const products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
                const product = products.find(p => p.id === productId);
                
                if (product && product.images && product.images.length > 0) {
                    console.log(`Carregando ${product.images.length} imagens`);
                    
                    // Exibe imagens existentes
                    product.images.forEach(image => {
                        // Verifica se a fun√ß√£o addImageToProductGallery existe
                        if (typeof addImageToProductGallery === 'function') {
                            addImageToProductGallery(image, productId);
                        } else {
                            // Fallback simples
                            const img = document.createElement('img');
                            img.src = image.src;
                            img.style.cssText = 'width: 100px; height: 100px; object-fit: cover; margin: 5px; border-radius: 4px;';
                            imageGallery.appendChild(img);
                        }
                    });
                } else {
                    console.log('Nenhuma imagem encontrada, exibindo estado vazio');
                    
                    // Exibe estado vazio
                    imageGallery.innerHTML = `
                        <div class="empty-state col-span-full text-center py-12">
                            <i class="fas fa-images text-6xl text-gray-300 mb-4"></i>
                            <h4 class="text-xl text-gray-500 mb-2">Nenhuma imagem adicionada</h4>
                            <p class="text-gray-400">Use o bot√£o acima para adicionar imagens do produto</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Erro ao carregar imagens do produto:', error);
                
                // Exibe estado de erro
                const imageGallery = document.getElementById('productImageGallery');
                if (imageGallery) {
                    imageGallery.innerHTML = `
                        <div class="error-state col-span-full text-center py-12">
                            <i class="fas fa-exclamation-triangle text-6xl text-red-300 mb-4"></i>
                            <h4 class="text-xl text-red-500 mb-2">Erro ao carregar imagens</h4>
                            <p class="text-red-400">Tente recarregar a p√°gina</p>
                        </div>
                    `;
                }
            }
        }

        /**
         * Gerencia imagens de um produto espec√≠fico
         */
        function manageProductImages(productId, productName) {
            try {
                console.log('=== INICIANDO GERENCIAMENTO DE IMAGENS ===');
                console.log('Produto ID:', productId);
                console.log('Produto Nome:', productName);
                
                // Initialize product images if not exists
                initializeProductImages(productId);
                
                console.log('Criando modal...');
                
                // Remove modal existente se houver
                const existingModal = document.querySelector('.modal-overlay');
                if (existingModal) {
                    console.log('Removendo modal existente');
                    existingModal.remove();
                }
                
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                `;
                
                modal.innerHTML = `
                    <div class="modal-content bg-white rounded-lg shadow-2xl p-6 w-full max-w-6xl mx-4 max-h-screen overflow-y-auto" style="max-height: 90vh;">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-semibold text-gray-800">Gerenciar Imagens - ${escapeHtml(productName)}</h3>
                            <button onclick="closeImageModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                                <i class="fas fa-times text-2xl"></i>
                            </button>
                        </div>
                        
                        <!-- Upload Area -->
                        <div class="upload-area mb-6 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-rose-medium transition-colors" id="uploadArea">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                            <h4 class="text-lg font-medium text-gray-700 mb-2">Adicionar Imagens</h4>
                            <p class="text-gray-500 mb-4">Arraste e solte imagens aqui ou clique para selecionar</p>
                            <div class="file-input-wrapper">
                                <input type="file" id="productImageUpload" multiple accept="image/*" style="display: none;">
                                <button onclick="document.getElementById('productImageUpload').click()" class="bg-rose-medium text-white px-6 py-3 rounded-lg hover:bg-rose-dark transition-colors duration-300">
                                    <i class="fas fa-upload mr-2"></i>
                                    Selecionar Imagens
                                </button>
                            </div>
                        </div>

                        <!-- Image Gallery -->
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4" id="productImageGallery">
                            <!-- Images will be loaded here -->
                        </div>
                        
                        <!-- Footer -->
                        <div class="mt-6 pt-4 border-t border-gray-200 text-center">
                            <button onclick="closeImageModal()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                                Fechar
                            </button>
                        </div>
                    </div>
                `;
                
                console.log('Adicionando modal ao DOM...');
                document.body.appendChild(modal);
                
                // Adiciona evento de clique para fechar modal ao clicar fora
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeImageModal();
                    }
                });
                
                console.log('Modal adicionado com sucesso!');
                
                // Load existing images
                console.log('Carregando imagens existentes...');
                loadProductImages(productId);
                
                // Setup drag and drop
                console.log('Configurando drag and drop...');
                setupDragAndDrop(productId);
                
                // Handle image upload for this product
                console.log('Configurando upload de imagens...');
                const uploadInput = document.getElementById('productImageUpload');
                if (uploadInput) {
                    uploadInput.addEventListener('change', function(e) {
                        console.log('Arquivos selecionados:', e.target.files.length);
                        const files = e.target.files;
                        if (files.length > 0) {
                            handleProductImageUpload(files, productId);
                        }
                    });
                } else {
                    console.error('Input de upload n√£o encontrado!');
                }
                
                console.log('=== MODAL CONFIGURADO COM SUCESSO ===');
                
            } catch (error) {
                console.error('ERRO ao abrir modal de imagens:', error);
                alert('Erro ao abrir gerenciamento de imagens. Verifique o console para mais detalhes.');
            }
        }

        /**
         * TESTE R√ÅPIDO - Verifica√ß√£o final do sistema
         */
        function testeRapido() {
            console.log('üöÄ TESTE R√ÅPIDO DO SISTEMA DE IMAGENS');
            
            const testes = [
                { nome: 'initializeProductImages', funcao: initializeProductImages },
                { nome: 'getDefaultProductData', funcao: getDefaultProductData },
                { nome: 'loadProductImages', funcao: loadProductImages },
                { nome: 'manageProductImages', funcao: manageProductImages }
            ];
            
            let todosOk = true;
            
            testes.forEach(teste => {
                if (typeof teste.funcao === 'function') {
                    console.log(`‚úÖ ${teste.nome}: OK`);
                } else {
                    console.log(`‚ùå ${teste.nome}: ERRO - n√£o √© fun√ß√£o`);
                    todosOk = false;
                }
            });
            
            if (todosOk) {
                console.log('üéâ TODOS OS TESTES PASSARAM!');
                console.log('üß™ Testando abertura do modal...');
                
                try {
                    manageProductImages('default-1', 'Teste R√°pido');
                    console.log('‚úÖ Modal aberto com sucesso!');
                    return true;
                } catch (error) {
                    console.error('‚ùå Erro ao abrir modal:', error);
                    return false;
                }
            } else {
                console.log('‚ùå Alguns testes falharam!');
                return false;
            }
        }

        // Exp√µe fun√ß√£o de teste globalmente
        window.testeRapido = testeRapido;

        /**
         * Monitora o uso do localStorage
         */
        function monitorarStorage() {
            try {
                let totalSize = 0;
                const keys = Object.keys(localStorage);
                const usage = {};
                
                keys.forEach(key => {
                    const value = localStorage.getItem(key);
                    const size = new Blob([value]).size;
                    totalSize += size;
                    usage[key] = {
                        size: size,
                        sizeFormatted: formatBytes(size),
                        items: key.includes('Products') ? JSON.parse(value || '[]').length : 1
                    };
                });
                
                const totalFormatted = formatBytes(totalSize);
                const limitEstimated = 5 * 1024 * 1024; // 5MB
                const percentUsed = ((totalSize / limitEstimated) * 100).toFixed(1);
                
                console.log('üìä USO DO LOCALSTORAGE:');
                console.log(`Total usado: ${totalFormatted} (${percentUsed}%)`);
                console.table(usage);
                
                if (totalSize > limitEstimated * 0.8) {
                    console.warn('‚ö†Ô∏è localStorage quase cheio! Considere limpeza.');
                    return { status: 'warning', totalSize, usage };
                }
                
                return { status: 'ok', totalSize, usage };
                
            } catch (error) {
                console.error('Erro ao monitorar storage:', error);
                return { status: 'error', error };
            }
        }

        /**
         * Formata bytes em formato leg√≠vel
         */
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        /**
         * Limpa dados duplicados e otimiza localStorage
         */
        function limparStorage() {
            try {
                console.log('üßπ Iniciando limpeza do localStorage...');
                
                // Monitora antes da limpeza
                const beforeCleanup = monitorarStorage();
                
                // Remove produtos duplicados
                const products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
                const uniqueProducts = [];
                const seenIds = new Set();
                
                products.forEach(product => {
                    if (!seenIds.has(product.id)) {
                        seenIds.add(product.id);
                        // Remove imagens muito grandes (>500KB)
                        if (product.images) {
                            product.images = product.images.filter(img => {
                                if (img.src && img.src.length > 500000) {
                                    console.log(`üóëÔ∏è Removendo imagem grande de ${product.name}`);
                                    return false;
                                }
                                return true;
                            });
                        }
                        uniqueProducts.push(product);
                    }
                });
                
                localStorage.setItem('atelieProducts', JSON.stringify(uniqueProducts));
                
                // Remove dados antigos/desnecess√°rios
                const keysToRemove = [];
                Object.keys(localStorage).forEach(key => {
                    if (key.includes('temp') || key.includes('old') || key.includes('backup')) {
                        keysToRemove.push(key);
                    }
                });
                
                keysToRemove.forEach(key => {
                    localStorage.removeItem(key);
                    console.log(`üóëÔ∏è Removido: ${key}`);
                });
                
                // Monitora depois da limpeza
                const afterCleanup = monitorarStorage();
                
                const savedBytes = beforeCleanup.totalSize - afterCleanup.totalSize;
                console.log(`‚úÖ Limpeza conclu√≠da! Economizados: ${formatBytes(savedBytes)}`);
                
                showNotification(`Limpeza conclu√≠da! Espa√ßo liberado: ${formatBytes(savedBytes)}`, 'success');
                
                return { 
                    success: true, 
                    before: beforeCleanup.totalSize, 
                    after: afterCleanup.totalSize, 
                    saved: savedBytes 
                };
                
            } catch (error) {
                console.error('Erro na limpeza:', error);
                showNotification('Erro durante a limpeza do storage', 'error');
                return { success: false, error };
            }
        }

        /**
         * Verifica espa√ßo antes de salvar dados
         */
        function verificarEspacoAntesDeSalvar(data) {
            try {
                const dataSize = new Blob([JSON.stringify(data)]).size;
                const currentUsage = monitorarStorage();
                const limitEstimated = 5 * 1024 * 1024; // 5MB
                
                if (currentUsage.totalSize + dataSize > limitEstimated * 0.9) {
                    console.warn('‚ö†Ô∏è Pouco espa√ßo dispon√≠vel, executando limpeza...');
                    limparStorage();
                    
                    // Verifica novamente ap√≥s limpeza
                    const newUsage = monitorarStorage();
                    if (newUsage.totalSize + dataSize > limitEstimated * 0.9) {
                        throw new Error('Espa√ßo insuficiente mesmo ap√≥s limpeza');
                    }
                }
                
                return true;
            } catch (error) {
                console.error('Erro na verifica√ß√£o de espa√ßo:', error);
                return false;
            }
        }

        // Exp√µe fun√ß√µes globalmente
        window.monitorarStorage = monitorarStorage;
        window.limparStorage = limparStorage;
        window.verificarEspacoAntesDeSalvar = verificarEspacoAntesDeSalvar;

        /**
         * LIMPEZA DE EMERG√äNCIA - Remove tudo e mant√©m apenas o essencial
         */
        function limpezaDeEmergencia() {
            const confirm1 = confirm('‚ö†Ô∏è LIMPEZA DE EMERG√äNCIA ‚ö†Ô∏è\n\nIsto ir√°:\n- Remover TODOS os dados\n- Manter apenas produtos padr√£o\n- Limpar todas as imagens\n\nContinuar?');
            
            if (!confirm1) return false;
            
            const confirm2 = confirm('üö® √öLTIMA CHANCE! üö®\n\nTem CERTEZA ABSOLUTA?\nEsta a√ß√£o √© IRREVERS√çVEL!');
            
            if (!confirm2) return false;
            
            try {
                console.log('üö® EXECUTANDO LIMPEZA DE EMERG√äNCIA...');
                
                // Backup dos dados antes de limpar (apenas console)
                const backup = {
                    products: localStorage.getItem('atelieProducts'),
                    images: localStorage.getItem('atelieImages'),
                    testimonials: localStorage.getItem('atelieTestimonials')
                };
                console.log('üì¶ Backup dos dados (copie se necess√°rio):', backup);
                
                // Remove TUDO
                localStorage.clear();
                
                // Recria apenas estrutura b√°sica
                localStorage.setItem('atelieProducts', '[]');
                localStorage.setItem('excludedProducts', '[]');
                
                console.log('‚úÖ Limpeza de emerg√™ncia conclu√≠da!');
                showNotification('üö® Limpeza de emerg√™ncia conclu√≠da! P√°gina ser√° recarregada.', 'success');
                
                // Recarrega a p√°gina ap√≥s 2 segundos
                setTimeout(() => {
                    location.reload();
                }, 2000);
                
                return true;
                
            } catch (error) {
                console.error('‚ùå Erro na limpeza de emerg√™ncia:', error);
                alert('Erro cr√≠tico! Feche e abra o navegador.');
                return false;
            }
        }

        /**
         * Interface de monitoramento de storage
         */
        function mostrarStatusStorage() {
            const usage = monitorarStorage();
            
            let message = `üìä STATUS DO STORAGE:\n\n`;
            
            if (usage.status === 'error') {
                message += `‚ùå Erro: ${usage.error}`;
            } else {
                message += `üíæ Total usado: ${formatBytes(usage.totalSize)}\n`;
                message += `üìà % do limite: ${((usage.totalSize / (5*1024*1024)) * 100).toFixed(1)}%\n\n`;
                
                message += `üìã Detalhes:\n`;
                Object.keys(usage.usage).forEach(key => {
                    const item = usage.usage[key];
                    message += `‚Ä¢ ${key}: ${item.sizeFormatted}`;
                    if (item.items > 1) message += ` (${item.items} itens)`;
                    message += `\n`;
                });
                
                if (usage.status === 'warning') {
                    message += `\n‚ö†Ô∏è STORAGE QUASE CHEIO!`;
                }
            }
            
            alert(message);
        }

        // Exp√µe fun√ß√µes de emerg√™ncia globalmente
        window.limpezaDeEmergencia = limpezaDeEmergencia;
        window.mostrarStatusStorage = mostrarStatusStorage;

        /**
         * SOLU√á√ÉO R√ÅPIDA para o erro de quota atual
         */
        function solucaoRapidaQuota() {
            console.log('üöÄ EXECUTANDO SOLU√á√ÉO R√ÅPIDA PARA QUOTA...');
            
            try {
                // 1. Monitora situa√ß√£o atual
                console.log('üìä Situa√ß√£o atual:');
                const statusAntes = monitorarStorage();
                
                // 2. Limpa produtos duplicados primeiro
                console.log('üßπ Limpando duplicatas...');
                const products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
                const uniqueProducts = [];
                const seenIds = new Set();
                
                products.forEach(product => {
                    if (!seenIds.has(product.id)) {
                        seenIds.add(product.id);
                        
                        // Remove imagens muito pesadas (>200KB)
                        if (product.images) {
                            product.images = product.images.filter(img => {
                                return !img.src || img.src.length <= 200000;
                            });
                        }
                        
                        uniqueProducts.push(product);
                    }
                });
                
                // 3. Salva a vers√£o limpa
                localStorage.setItem('atelieProducts', JSON.stringify(uniqueProducts));
                
                // 4. Remove dados tempor√°rios
                const keysToRemove = [];
                Object.keys(localStorage).forEach(key => {
                    if (key.includes('temp') || key.includes('cache') || key.includes('old')) {
                        keysToRemove.push(key);
                    }
                });
                keysToRemove.forEach(key => localStorage.removeItem(key));
                
                // 5. Monitora ap√≥s limpeza
                console.log('üìä Situa√ß√£o ap√≥s limpeza:');
                const statusDepois = monitorarStorage();
                
                const espacoLiberado = statusAntes.totalSize - statusDepois.totalSize;
                
                console.log(`‚úÖ Limpeza conclu√≠da! Liberados: ${formatBytes(espacoLiberado)}`);
                
                // 6. Testa se agora consegue adicionar produto
                try {
                    const testProduct = {
                        id: 'test-quota-fix',
                        name: 'Teste Quota',
                        description: 'Produto de teste para verificar quota',
                        price: '1.00',
                        category: 'test',
                        images: [],
                        status: 'Ativo'
                    };
                    
                    const updatedProducts = [...uniqueProducts, testProduct];
                    localStorage.setItem('atelieProducts', JSON.stringify(updatedProducts));
                    
                    // Remove o produto de teste
                    localStorage.setItem('atelieProducts', JSON.stringify(uniqueProducts));
                    
                    console.log('‚úÖ Teste de quota passou! Agora voc√™ pode adicionar produtos.');
                    showNotification(`‚úÖ Problema resolvido! Espa√ßo liberado: ${formatBytes(espacoLiberado)}`, 'success');
                    
                    // Remove alerta de quota da interface
                    const quotaAlert = document.querySelector('.bg-red-50');
                    if (quotaAlert) {
                        quotaAlert.style.display = 'none';
                    }
                    
                    return true;
                    
                } catch (error) {
                    console.error('‚ùå Ainda h√° problema de quota:', error);
                    showNotification('‚ùå Quota ainda cr√≠tica. Execute limpeza de emerg√™ncia.', 'error');
                    return false;
                }
                
            } catch (error) {
                console.error('‚ùå Erro na solu√ß√£o r√°pida:', error);
                showNotification('‚ùå Erro na solu√ß√£o r√°pida. Tente limpeza de emerg√™ncia.', 'error');
                return false;
            }
        }

        // Exp√µe fun√ß√£o globalmente
        window.solucaoRapidaQuota = solucaoRapidaQuota;

        /**
         * üö® CORRE√á√ÉO IMEDIATA - Execute no console para resolver AGORA
         */
        function corrigirQuotaAgora() {
            console.log('üö® EXECUTANDO CORRE√á√ÉO IMEDIATA...');
            
            try {
                // 1. Backup dos dados essenciais
                const products = JSON.parse(localStorage.getItem('atelieProducts') || '[]');
                console.log(`üì¶ Encontrados ${products.length} produtos`);
                
                // 2. Limpa TUDO primeiro
                console.log('üßπ Limpando localStorage...');
                localStorage.clear();
                
                // 3. Recria com apenas dados essenciais (SEM IMAGENS PESADAS)
                const produtosLimpos = products.map(product => ({
                    id: product.id,
                    name: product.name,
                    description: product.description,
                    price: product.price,
                    category: product.category,
                    shopeeLink: product.shopeeLink || '',
                    status: 'Ativo',
                    images: [], // Remove TODAS as imagens por enquanto
                    createdAt: product.createdAt || new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                }));
                
                // 4. Salva vers√£o limpa
                localStorage.setItem('atelieProducts', JSON.stringify(produtosLimpos));
                localStorage.setItem('excludedProducts', '[]');
                
                console.log(`‚úÖ Salvos ${produtosLimpos.length} produtos SEM imagens`);
                
                // 5. Testa se agora consegue adicionar
                const testData = JSON.stringify([...produtosLimpos, { 
                    id: 'test', name: 'Teste', description: 'test', price: '1.00', category: 'test' 
                }]);
                
                localStorage.setItem('testQuota', testData);
                localStorage.removeItem('testQuota');
                
                console.log('üéâ SUCESSO! Agora voc√™ pode adicionar produtos!');
                alert('‚úÖ QUOTA CORRIGIDA!\n\nAgora voc√™ pode:\n1. Adicionar produtos normalmente\n2. Adicionar imagens depois (uma por vez)\n3. O sistema est√° funcionando!');
                
                // Recarrega a p√°gina
                setTimeout(() => {
                    location.reload();
                }, 1000);
                
                return true;
                
            } catch (error) {
                console.error('‚ùå Erro na corre√ß√£o:', error);
                alert('‚ùå Erro cr√≠tico! Tente:\n1. Fechar todas as abas\n2. Abrir s√≥ uma aba\n3. Executar novamente');
                return false;
            }
        }

        // EXPOSI√á√ÉO GLOBAL
        window.corrigirQuotaAgora = corrigirQuotaAgora;

        /**
         * üí• RESET TOTAL - Use apenas se nada mais funcionar
         */
        function resetCompleto() {
            const confirmacao = confirm('üí• RESET COMPLETO\n\nIsto ir√°:\n‚úÖ Limpar TODA a mem√≥ria\n‚úÖ Come√ßar do zero\n‚úÖ Resolver 100% o problema\n\n‚ùå Perder todos os dados\n\nContinuar?');
            
            if (!confirmacao) return false;
            
            try {
                console.log('üí• EXECUTANDO RESET COMPLETO...');
                
                // Limpa absolutamente tudo
                localStorage.clear();
                sessionStorage.clear();
                
                // Recria estrutura m√≠nima
                localStorage.setItem('atelieProducts', '[]');
                localStorage.setItem('excludedProducts', '[]');
                localStorage.setItem('atelieImages', '[]');
                localStorage.setItem('atelieTestimonials', '[]');
                
                console.log('‚úÖ Reset completo executado!');
                alert('üí• RESET COMPLETO!\n\n‚úÖ Mem√≥ria totalmente limpa\n‚úÖ Sistema restaurado\n‚úÖ Pronto para usar\n\nA p√°gina ser√° recarregada...');
                
                // Recarrega ap√≥s 1 segundo
                setTimeout(() => {
                    location.reload();
                }, 1000);
                
                return true;
                
            } catch (error) {
                console.error('‚ùå Erro no reset:', error);
                alert('‚ùå Erro cr√≠tico!\n\nFeche o navegador completamente e abra novamente.');
                return false;
            }
        }

        // Exposi√ß√£o global
        window.resetCompleto = resetCompleto;
    </script>
</body>
</html> 